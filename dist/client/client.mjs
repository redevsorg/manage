import{a as ie,c as bo,d as gt,e as xo,f as vo,g as yo,h as wo,j as ht,l as Co,m as Pe,n as Ue,o as Lt,q as st}from"../chunk-5MZS52RA.mjs";import{a as g,b as y,c as W,d as A}from"../chunk-MIGENICT.mjs";import{createContext as No}from"react";import{jsx as Er}from"react/jsx-runtime";var Ft=No({}),ko=({children:e,repoOwner:t,repoSlug:o,repoBranch:r,contentPath:n,monorepoPath:s,session:l,collections:a,pages:i,addPage:c,removePage:m,hasOpenAIKey:b,hasChanges:d,setHasChanges:u})=>Er(Ft.Provider,{value:{repoOwner:t||"",repoSlug:o||"",repoBranch:r||"main",contentPath:n||"outstatic/content",monorepoPath:s||"",session:l,collections:a,pages:i,addPage:c,removePage:m,hasOpenAIKey:b,hasChanges:d,setHasChanges:u},children:e}),De=No({});import{ApolloProvider as Hi}from"@apollo/client";import{useEffect as _i,useState as ho}from"react";import Tr from"next/image";import{Fragment as Lr,jsx as je,jsxs as Or}from"react/jsx-runtime";function It(){return je(Lr,{children:je("div",{id:"outstatic",children:Or("main",{className:"relative flex h-screen flex-col items-center justify-center z-10 p-4 bg-black",children:[je("h1",{className:"mb-8 text-center text-xl font-semibold text-white border-2 px-6 p-2 rounded-full border-neutral-800",children:je(Tr,{src:"https://redevs.org/redevs.svg",alt:"",width:150,height:100,className:"invert"})}),je("div",{className:"text-center mb-20 flex max-w-2xl flex-col items-center p-8 px-4 md:p-8 text-white bg-black rounded-lg border-2 border-neutral-800 shadow-md",children:je("p",{className:"text-2xl",children:"404 - Nothing here..."})})]})})})}import{useContext as Fr}from"react";function L(){return Fr(Ft)}import Ir from"next/link";import{useRouter as Rr}from"next/navigation";import{useCallback as $r}from"react";import{jsx as Br}from"react/jsx-runtime";var zr=n=>{var s=n,{href:e,onClick:t,children:o}=s,r=W(s,["href","onClick","children"]);let l=Rr(),{hasChanges:a,setHasChanges:i}=L(),c=$r(m=>{m.preventDefault(),t&&t(m),a?window.confirm("You have unsaved changes. Are you sure you wish to leave this page?")&&(i(!1),l.push(e.toString())):l.push(e.toString())},[a,t,i,l,e]);return Br(Ir,y(g({href:e,onClick:c},r),{children:o}))},qe=zr;import{useRouter as So}from"next/navigation";import{useEffect as Hr}from"react";import _r from"swr";var Vr=e=>fetch(e).then(t=>t.json()).then(t=>t||null),pe=({redirectTo:e,redirectIfFound:t}={})=>{let{data:o,error:r}=_r("/api/redevs/user",Vr),n=o==null?void 0:o.session,s=!!o,l=!!n,a=So();return Hr(()=>{!e||!s||(e&&!t&&!l||t&&l)&&a.push(e)},[e,t,s,l]),o?o&&!l||r?{session:null,status:"unauthenticated"}:{session:n,status:"authenticated"}:{session:null,status:"loading"}};function Mo(){let e=So();return{signOut:()=>{e.push("/api/redevs/signout")}}}import{Menu as Ur}from"lucide-react";import{useState as jr}from"react";import qr from"next/image";import{Fragment as Gr,jsx as ee,jsxs as We}from"react/jsx-runtime";var Wr=({name:e,email:t,image:o,status:r,toggleSidebar:n})=>{let[s,l]=jr(!1),{signOut:a}=Mo();return ee(Gr,{children:ee("nav",{className:"relative border-b-2 border-neutral-800 bg-black px-2 py-2.5 sm:px-4 h-14",children:We("div",{className:"mx-auto flex flex-wrap items-center justify-between",children:[We("button",{"data-collapse-toggle":"mobile-menu-2",type:"button",className:"ml-1 inline-flex items-center rounded-lg p-2 text-sm text-neutral-100 hover:bg-neutral-900 focus:outline-none focus:ring-2 focus:ring-neutral-900 lg:hidden","aria-controls":"mobile-menu-2","aria-expanded":"false",onClick:n,children:[ee("span",{className:"sr-only",children:"Open main menu"}),ee(Ur,{})]}),ee(qe,{href:"/redevs","aria-label":"Redevs",children:ee("div",{className:"cursor-pointer flex items-center",children:ee(qr,{src:"https://redevs.org/redevs.svg",alt:"",width:100,height:70,className:"invert"})})}),r==="loading"||We("div",{className:"flex items-center md:order-2",children:[We("button",{type:"button",className:"mr-3 flex items-center rounded-full bg-neutral-800 text-sm focus:ring-4 focus:ring-neutral-800 md:mr-0",id:"user-menu-button","aria-expanded":"false","data-dropdown-toggle":"dropdown",onClick:()=>l(!s),children:[ee("span",{className:"sr-only",children:"Open user menu"}),ee("img",{className:"h-8 w-8 rounded-full",src:o||"",alt:"user"})]}),We("div",{className:`right-0 top-[60px] z-50 my-4 w-full list-none divide-y-2 divide-neutral-800 rounded-br rounded-bl bg-black text-base shadow md:-right-0 md:top-[52px] md:w-auto ${s?"block":"hidden"}`,id:"dropdown",style:{position:"absolute",margin:"0px"},children:[We("div",{className:"py-3 px-4",children:[ee("span",{className:"block text-sm text-white",children:e}),ee("span",{className:"block truncate text-sm font-medium text-neutral-400",children:t})]}),ee("ul",{className:"py-1","aria-labelledby":"dropdown",children:ee("li",{children:ee("a",{className:"block cursor-pointer py-2 px-4 text-sm text-neutral-400 hover:bg-neutral-800",onClick:a,children:"Sign out"})})})]})]})]})})})},Rt=Wr;function Kr(o){return A(this,arguments,function*({repoOwner:e,repoSlug:t}){let n=new TextEncoder().encode(e+t),s=yield window.crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(s)).map(i=>i.toString(16).padStart(2,"0")).join("")})}var Po=Kr;import Do from"js-cookie";import{useEffect as Jr,useState as Zr}from"react";import{Fragment as Xr,jsx as E,jsxs as fe}from"react/jsx-runtime";var Qr=()=>{let e=Do.get("ost_broadcast");return e?JSON.parse(e):null},Yr=({isOpen:e=!1})=>{let[t,o]=Zr(Qr()),{collections:r,repoOwner:n,repoSlug:s}=L();return Jr(()=>{t||(()=>A(void 0,null,function*(){let a=new URL("https://analytics.outstatic.com/"),i=Intl.DateTimeFormat().resolvedOptions().timeZone,c=yield Po({repoOwner:n,repoSlug:s});a.searchParams.append("timezone",i),a.searchParams.append("unique_id",c),a.searchParams.append("version",Co),yield fetch(a.toString()).then(m=>m.json()).then(m=>{m!=null&&m.title&&(o(m),Do.set("ost_broadcast",JSON.stringify(m),{expires:1}))}).catch(m=>{console.log(m)})}))()},[]),fe("aside",{className:`absolute top-[53px] z-20 h-full w-full md:relative md:top-0 lg:block md:w-64 md:min-w-[16rem] ${e?"block":"hidden"}`,"aria-label":"Sidebar",children:[fe("div",{className:"flex flex-col py-4 px-3 h-full max-h-[calc(100vh-96px)] overflow-y-scroll scrollbar-hide bg-neutral-900 justify-between",children:[fe("ul",{className:"space-y-2",children:[E("li",{children:E(qe,{href:"/redevs",children:fe("div",{className:"flex items-center rounded-lg p-2 text-base font-normal text-neutral-100 hover:bg-neutral-800 cursor-pointer",children:[fe("svg",{className:"h-6 w-6 shrink-0 text-neutral-100 transition duration-75 group-hover:text-neutral-100",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24",children:[E("path",{fill:"none",d:"M0 0h24v24H0z"}),E("path",{fill:"currentColor",d:"M13 21V11h8v10h-8zM3 13V3h8v10H3zm6-2V5H5v6h4zM3 21v-6h8v6H3zm2-2h4v-2H5v2zm10 0h4v-6h-4v6zM13 3h8v6h-8V3zm2 2v2h4V5h-4z"})]}),E("span",{className:"ml-3",children:"Collections"})]})})}),E(Xr,{children:r.map(l=>E("li",{children:E(qe,{href:`/redevs/${l}`,children:fe("div",{className:"flex items-center rounded-lg p-2 text-base font-normal text-neutral-100 hover:bg-neutral-800 cursor-pointer",children:[E("svg",{className:"h-6 w-6 shrink-0 text-neutral-100 transition duration-75 group-hover:text-neutral-100",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:E("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),E("span",{className:"ml-3 capitalize",children:l})]})})},l))}),E("li",{children:E(qe,{href:"/redevs/settings",children:fe("div",{className:"flex items-center rounded-lg p-2 text-base font-normal text-neutral-100 hover:bg-neutral-800 cursor-pointer",children:[E("svg",{className:"h-6 w-6 shrink-0 text-neutral-100 transition duration-75 group-hover:text-neutral-100",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:E("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})}),E("span",{className:"ml-3 flex-1 whitespace-nowrap",children:"Settings"})]})})})]}),t?fe("div",{className:"p-4 mt-6 rounded-lg bg-black border-2 border-neutral-800",role:"alert",children:[E("div",{className:"flex items-center text-white mb-3",children:E("span",{className:"bg-amber-100 text-amber-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full",children:"Powered by Redevs"})}),E("p",{className:"text-sm text-white",children:"Content management by Redevs. Built with Outstatic."}),t!=null&&t.link?E("a",{href:"https://outstatic.com",target:"_blank",rel:"noreferrer",children:E("span",{className:"mt-3 text-xs underline font-medium text-white",children:"Learn more"})}):null]}):null]}),fe("div",{className:"h-10 bg-neutral-900 py-2 px-4 border-t-2 border-neutral-800 text-xs flex justify-between items-center w-full",children:[E("a",{className:"font-semibold text-gray-500 hover:underline hover:text-gray-400",href:"https://outstatic.com/docs",target:"_blank",rel:"noreferrer",children:"Documentation"}),fe("div",{className:"gap-2 flex items-center justify-center",children:[E("a",{href:"https://github.com/redevsorg",target:"_blank","aria-label":"GitHub",rel:"noreferrer",className:"group",children:E("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"none","aria-label":"GitHub logo",children:E("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z",transform:"scale(1.2)",className:"fill-gray-400 group-hover:fill-gray-300"})})}),E("a",{href:"https://redevs.org/",target:"_blank","aria-label":"X.com",rel:"noreferrer",className:"group w-5 h-5 flex items-center justify-center",children:E("svg",{xmlns:"http://www.w3.org/2000/svg",width:"17",height:"17",viewBox:"0 0 26 26",children:E("path",{className:"fill-gray-400 group-hover:fill-gray-300",d:"M13.723 18.654l-3.61 3.609c-2.316 2.315-6.063 2.315-8.378 0-1.12-1.118-1.735-2.606-1.735-4.188 0-1.582.615-3.07 1.734-4.189l4.866-4.865c2.355-2.355 6.114-2.262 8.377 0 .453.453.81.973 1.089 1.527l-1.593 1.592c-.18-.613-.5-1.189-.964-1.652-1.448-1.448-3.93-1.51-5.439-.001l-.001.002-4.867 4.865c-1.5 1.499-1.5 3.941 0 5.44 1.517 1.517 3.958 1.488 5.442 0l2.425-2.424c.993.284 1.791.335 2.654.284zm.161-16.918l-3.574 3.576c.847-.05 1.655 0 2.653.283l2.393-2.389c1.498-1.502 3.94-1.5 5.44-.001 1.517 1.518 1.486 3.959 0 5.442l-4.831 4.831-.003.002c-1.438 1.437-3.886 1.552-5.439-.002-.473-.474-.785-1.042-.956-1.643l-.084.068-1.517 1.515c.28.556.635 1.075 1.088 1.528 2.245 2.245 6.004 2.374 8.378 0l4.832-4.831c2.314-2.316 2.316-6.062-.001-8.377-2.317-2.321-6.067-2.313-8.379-.002z"})})}),E("a",{href:"https://redevs.org/discord",target:"_blank","aria-label":"Discord",rel:"noreferrer",className:"group w-5 h-5 flex items-center justify-center",children:E("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",width:"18",height:"18",viewBox:"0 -28.5 256 256",version:"1.1",preserveAspectRatio:"xMidYMid",children:E("g",{children:E("path",{className:"fill-gray-400 group-hover:fill-gray-300",d:"M216.856339,16.5966031 C200.285002,8.84328665 182.566144,3.2084988 164.041564,0 C161.766523,4.11318106 159.108624,9.64549908 157.276099,14.0464379 C137.583995,11.0849896 118.072967,11.0849896 98.7430163,14.0464379 C96.9108417,9.64549908 94.1925838,4.11318106 91.8971895,0 C73.3526068,3.2084988 55.6133949,8.86399117 39.0420583,16.6376612 C5.61752293,67.146514 -3.4433191,116.400813 1.08711069,164.955721 C23.2560196,181.510915 44.7403634,191.567697 65.8621325,198.148576 C71.0772151,190.971126 75.7283628,183.341335 79.7352139,175.300261 C72.104019,172.400575 64.7949724,168.822202 57.8887866,164.667963 C59.7209612,163.310589 61.5131304,161.891452 63.2445898,160.431257 C105.36741,180.133187 151.134928,180.133187 192.754523,160.431257 C194.506336,161.891452 196.298154,163.310589 198.110326,164.667963 C191.183787,168.842556 183.854737,172.420929 176.223542,175.320965 C180.230393,183.341335 184.861538,190.991831 190.096624,198.16893 C211.238746,191.588051 232.743023,181.531619 254.911949,164.955721 C260.227747,108.668201 245.831087,59.8662432 216.856339,16.5966031 Z M85.4738752,135.09489 C72.8290281,135.09489 62.4592217,123.290155 62.4592217,108.914901 C62.4592217,94.5396472 72.607595,82.7145587 85.4738752,82.7145587 C98.3405064,82.7145587 108.709962,94.5189427 108.488529,108.914901 C108.508531,123.290155 98.3405064,135.09489 85.4738752,135.09489 Z M170.525237,135.09489 C157.88039,135.09489 147.510584,123.290155 147.510584,108.914901 C147.510584,94.5396472 157.658606,82.7145587 170.525237,82.7145587 C183.391518,82.7145587 193.761324,94.5189427 193.539891,108.914901 C193.539891,123.290155 183.391518,135.09489 170.525237,135.09489 Z","fill-rule":"nonzero"})})})})]})]})]})},$t=Yr;import{useRouter as en}from"next/navigation";import{useEffect as tn,useState as on}from"react";import{Toaster as rn}from"sonner";import{Fragment as nn,jsx as at,jsxs as it}from"react/jsx-runtime";function te({children:e,error:t,settings:o,title:r}){let{session:n,status:s}=pe(),{push:l}=en(),[a,i]=on(!1),c=()=>{i(!a)};return tn(()=>{let m=r?`${r} | Redevs`:"Redevs";document.title=m},[r]),s==="unauthenticated"?(typeof window!="undefined"&&l("/redevs"),null):at(nn,{children:it("div",{id:"outstatic",children:[at(rn,{richColors:!0}),s==="loading"?null:it("div",{className:"flex h-screen flex-col bg-black text-white",children:[at(Rt,y(g({},n==null?void 0:n.user),{status:s,toggleSidebar:c})),it("div",{className:"flex md:grow flex-col-reverse justify-between md:flex-row",children:[at($t,{isOpen:a}),it("main",{className:"w-auto flex-auto p-5 md:p-10 bg-black h-dvh max-h-[calc(100vh-128px)] md:max-h-[calc(100vh-53px)] overflow-y-scroll scrollbar-hide",children:[t&&it("div",{className:"mb-6 border border-red-500 p-2",children:["Something went wrong"," ",at("span",{role:"img","aria-label":"sad face",children:"\u{1F613}"})]}),e]}),o&&o]})]})]})})}import{useFormContext as sn}from"react-hook-form";import{Fragment as ln,jsx as Ge,jsxs as Eo}from"react/jsx-runtime";var Ao={small:{label:"mb-1 block text-sm font-medium text-gray-900",input:"block w-full rounded-lg border border-gray-300 bg-gray-50 p-2 text-sm text-gray-900 outline-none focus:border-blue-500 focus:ring-blue-500"},medium:{label:"block mb-2 text-sm font-medium text-gray-900",input:"block p-2 w-full text-gray-900 bg-gray-50 rounded-lg border border-gray-300 sm:text-sm outline-none focus:ring-blue-500 focus:border-blue-500"}},an=b=>{var d=b,{label:e,placeholder:t="",helperText:o,id:r,type:n="text",readOnly:s=!1,registerOptions:l,wrapperClass:a,className:i,inputSize:c="medium"}=d,m=W(d,["label","placeholder","helperText","id","type","readOnly","registerOptions","wrapperClass","className","inputSize"]);var h,x,f,v;let{register:u,formState:{errors:p}}=sn();return Eo("div",{className:a,children:[e&&Ge("label",{htmlFor:r,className:`${Ao[c].label} first-letter:capitalize`,children:e}),Ge("div",{className:"relative",children:Ge("input",y(g(g({},u(r,l)),m),{className:`${Ao[c].input} ${i}`,type:n,name:r,id:r,readOnly:s,placeholder:t,"aria-describedby":r}))}),Ge(ln,{children:(((h=p[r])==null?void 0:h.message)||o)&&Eo("div",{className:"mt-1 first-letter:capitalize",children:[o&&Ge("p",{className:"text-xs text-gray-500",children:o}),((x=p[r])==null?void 0:x.message)&&Ge("span",{className:"text-sm text-red-500",children:(v=(f=p[r])==null?void 0:f.message)==null?void 0:v.toString()})]})})]})},ne=an;import{jsx as mn}from"react/jsx-runtime";var cn=({onClick:e,editor:t,children:o,name:r,disabled:n=!1,attributes:s={},tag:l="button",htmlFor:a})=>{let i=l,c={};return a&&(c.htmlFor=a),mn(i,y(g({onClick:m=>{m.preventDefault(),e()},title:r,className:`group border-r border-neutral-800 py-4 px-4 last-of-type:border-r-0 disabled:cursor-not-allowed disabled:hover:bg-neutral-700 ${t.isActive(r,s)?"is-active bg-black":"bg-neutral-800 text-white hover:bg-neutral-900"}`,disabled:n},c),{children:o}))},U=cn;import{create as un}from"zustand";var Ke=un(e=>({files:[],addFile:t=>e(o=>({files:[...o.files,t]})),removeFile:t=>e(o=>({files:o.files.filter(r=>r.blob!==t)}))}));import{useCallback as To,useState as bt}from"react";import{Fragment as xt,jsx as Q,jsxs as $e}from"react/jsx-runtime";var dn=({editor:e,setImageSelected:t})=>{let{removeFile:o}=Ke(),[r,n]=bt(!1),[s,l]=bt(""),[a,i]=bt(!1),[c,m]=bt(""),b=To(()=>{e.chain().focus().extendMarkRange("link").setLink({href:s}).run(),(s===""||s===void 0)&&e.chain().focus().extendMarkRange("link").unsetLink().run(),n(!1),e.chain().blur().run(),l("")},[e,s]),d=To(()=>{e.chain().focus().extendMarkRange("link").unsetLink().updateAttributes("image",{alt:c}).setLink({href:e.getAttributes("link").href}).run(),i(!1),t(!0),e.chain().blur().run(),l(""),m("")},[e,c,t]),u=()=>{let p=e.getAttributes("image").src;o(p),e.chain().focus().deleteSelection().run(),t(!1)};return $e(xt,{children:[a&&$e(xt,{children:[Q(U,{onClick:()=>{i(!1),t(!0)},editor:e,name:"back",children:$e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24",children:[Q("path",{fill:"none",d:"M0 0h24v24H0z"}),Q("path",{fill:"white",d:"M7.828 11H20v2H7.828l5.364 5.364-1.414 1.414L4 12l7.778-7.778 1.414 1.414z"})]})}),Q("input",{id:"alt-text",name:"alt-text",required:!0,className:"w-[500px] border-2 border-neutral-800 py-2 px-3 outline-none bg-black text-white",placeholder:"Insert alt text here",onChange:p=>{m(p.target.value.trim())},onKeyDown:p=>{p.key==="Enter"&&d(),p.key==="Escape"&&(i(!1),t(!0))},defaultValue:c,autoFocus:!0}),Q(U,{onClick:d,editor:e,name:"addAltText",children:"Done"})]}),r&&$e(xt,{children:[Q(U,{onClick:()=>{e.isActive("image")&&t(!0),n(!1)},editor:e,name:"back",children:$e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24",children:[Q("path",{fill:"none",d:"M0 0h24v24H0z"}),Q("path",{fill:"white",d:"M7.828 11H20v2H7.828l5.364 5.364-1.414 1.414L4 12l7.778-7.778 1.414 1.414z"})]})}),Q("input",{id:"link",name:"link",type:"url",required:!0,className:"w-[500px] border-2 border-neutral-800 py-2 px-3 outline-none bg-black text-white",placeholder:"Insert link here",onChange:p=>{l(p.target.value.trim())},onKeyDown:p=>{p.key==="Enter"&&b(),p.key==="Escape"&&n(!1)},autoFocus:!0,defaultValue:s}),Q(U,{onClick:b,editor:e,name:"submitLink",children:"Done"})]}),!a&&!r&&$e(xt,{children:[Q(U,{onClick:()=>{l(e.getAttributes("link").href),n(!0)},editor:e,name:"Link",children:$e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24",children:[Q("path",{fill:"none",d:"M0 0h24v24H0z"}),Q("path",{fill:"white",d:"M18.364 15.536L16.95 14.12l1.414-1.414a5 5 0 1 0-7.071-7.071L9.879 7.05 8.464 5.636 9.88 4.222a7 7 0 0 1 9.9 9.9l-1.415 1.414zm-2.828 2.828l-1.415 1.414a7 7 0 0 1-9.9-9.9l1.415-1.414L7.05 9.88l-1.414 1.414a5 5 0 1 0 7.071 7.071l1.414-1.414 1.415 1.414zm-.708-10.607l1.415 1.415-7.071 7.07-1.415-1.414 7.071-7.07z"})]})}),Q(U,{onClick:()=>{m(e.getAttributes("image").alt),i(!0)},editor:e,name:"image",attributes:e.getAttributes("image").alt?{alt:e.getAttributes("image").alt}:{alt:!1},children:"Alt Text"}),Q(U,{onClick:u,editor:e,name:"remove-image",children:"Remove Image"})]})]})},zt=dn;import{BubbleMenu as pn,isTextSelection as fn}from"@tiptap/react";import{ArrowLeft as gn,Bold as hn,Code2 as bn,Heading2 as xn,Heading3 as vn,Italic as yn,Link as wn,Terminal as Cn,TextQuote as Nn,Undo2 as kn}from"lucide-react";import{useCallback as Sn,useEffect as Mn,useState as Bt}from"react";import{Fragment as Oo,jsx as H,jsxs as Ht}from"react/jsx-runtime";var Pn=({editor:e})=>{let[t,o]=Bt(!1),[r,n]=Bt(!1),[s,l]=Bt(""),a=Sn(()=>{e.chain().focus().extendMarkRange("link").setLink({href:s}).run(),(s===""||s===void 0)&&e.chain().focus().extendMarkRange("link").unsetLink().run(),n(!1),e.chain().blur().run(),l("")},[e,s]);return Mn(()=>{let i=()=>{e.isActive("image")&&o(!0)};e.on("selectionUpdate",i),e.on("focus",i)},[e]),H(pn,{editor:e,tippyOptions:{duration:100,maxWidth:500,onHidden:()=>{o(!1),n(!1)}},shouldShow:({editor:i,view:c,state:m,from:b,to:d})=>{let{doc:u,selection:p}=m,{empty:h}=p,x=!u.textBetween(b,d).length&&fn(m.selection);return!(!c.hasFocus()||h||x||i.isActive("codeBlock"))},children:Ht("div",{className:"flex prose-sm rounded-md transition-all",children:[r&&Ht(Oo,{children:[H(U,{onClick:()=>{n(!1)},editor:e,name:"back",children:H(gn,{size:18})}),H("input",{id:"link",name:"link",type:"url",required:!0,className:"w-[500px] border-r border-slate-200 py-2 px-3 outline-none",placeholder:"Insert link here",onChange:i=>{l(i.target.value.trim())},onKeyDown:i=>{i.key==="Enter"&&a(),i.key==="Escape"&&n(!1)},autoFocus:!0,defaultValue:s}),H(U,{onClick:a,editor:e,name:"submitLink",children:"Done"})]}),t&&H(zt,{editor:e,setImageSelected:o}),!t&&!r&&Ht(Oo,{children:[H(U,{onClick:()=>e.chain().focus().toggleBold().run(),editor:e,name:"bold",children:H(hn,{size:18})}),H(U,{onClick:()=>e.chain().focus().toggleItalic().run(),editor:e,name:"italic",children:H(yn,{size:18})}),H(U,{onClick:()=>{l(e.getAttributes("link").href),n(!0)},editor:e,name:"link",children:H(wn,{size:18})}),H(U,{onClick:()=>e.chain().focus().toggleCode().run(),editor:e,name:"code",children:H(Cn,{size:18})}),H(U,{onClick:()=>e.chain().focus().toggleHeading({level:2}).run(),editor:e,name:"heading",attributes:{level:2},children:H(xn,{size:18})}),H(U,{onClick:()=>e.chain().focus().toggleHeading({level:3}).run(),editor:e,name:"heading",attributes:{level:3},children:H(vn,{size:18})}),H(U,{onClick:()=>e.chain().focus().toggleCodeBlock({language:"javascript"}).run(),editor:e,name:"codeBlock",children:H(bn,{size:18})}),H(U,{onClick:()=>e.chain().focus().toggleBlockquote().run(),editor:e,name:"blockquote",children:H(Nn,{size:18})}),H(U,{onClick:()=>e.chain().focus().clearNodes().run(),editor:e,name:"clear",children:H(kn,{size:18})})]})]})})},_t=Pn;import{EditorContent as Dn}from"@tiptap/react";import{useFormContext as An}from"react-hook-form";import{Fragment as Tn,jsx as vt,jsxs as On}from"react/jsx-runtime";var En=({id:e,editor:t})=>{var s,l,a;let{watch:o,formState:{errors:r}}=An(),n=o("content");return On(Tn,{children:[t&&vt(_t,{editor:t}),vt(Dn,{name:"content",value:n,editor:t,className:""}),vt("div",{className:"mt-1",children:((s=r[e])==null?void 0:s.message)&&vt("span",{className:"text-sm text-red-500",children:(a=(l=r[e])==null?void 0:l.message)==null?void 0:a.toString()})})]})},Vt=En;import{useState as Ln}from"react";import{jsx as Je,jsxs as Lo}from"react/jsx-runtime";var Fn=({title:e,callback:t,children:o,error:r=!1})=>{let[n,s]=Ln(!1);return Lo("div",{className:"w-full border-b-2 first:border-t-2 border-neutral-800",children:[Je("h2",{id:"accordion-collapse-heading-1 bg-red-50 ",children:Lo("button",{type:"button",className:`flex items-center justify-between w-full text-sm font-medium text-white p-4 hover:bg-neutral-800 focus:outline-none focus:outline-neutral-700 focus:outline-offset-[-1px] ${r?"bg-red-50":""}`,onClick:()=>{s(!n),t&&t()},children:[Je("span",{className:"capitalize",children:e}),Je("svg",{"data-accordion-icon":!0,className:`w-6 h-6 shrink-0 ${n?"":"rotate-180"}`,fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:Je("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]})}),Je("div",{className:n?"block":"hidden",children:Je("div",{className:"p-4 font-light border-neutral-800 border-t",children:o})})]})},Ze=Fn;import{forwardRef as In,createElement as Rn}from"react";import $n from"react-datepicker";import{Fragment as Un,jsx as le,jsxs as Fo}from"react/jsx-runtime";var zn={year:"numeric",month:"long",day:"numeric"},Bn=e=>e.getFullYear(),Hn=e=>e.getMonth(),_n=Array.from({length:100},(e,t)=>new Date().getFullYear()-t),Ut=["January","February","March","April","May","June","July","August","September","October","November","December"],Vn=({date:e,setDate:t,id:o,label:r})=>Fo(Un,{children:[r&&le("label",{className:"block text-sm font-medium text-white",htmlFor:o,children:r}),le("div",{children:le($n,{name:o,selected:e,onChange:s=>{t(s)},renderCustomHeader:({date:s,changeYear:l,changeMonth:a,decreaseMonth:i,increaseMonth:c,prevMonthButtonDisabled:m,nextMonthButtonDisabled:b})=>Fo("div",{className:"react-datepicker__header",children:[le("select",{className:"react-datepicker__current-month appearance-none cursor-pointer hover:text-blue-500",value:Bn(s),onChange:({target:{value:d}})=>l(Number(d)),children:_n.map(d=>le("option",{value:d,children:d},d))}),le("select",{className:"react-datepicker__current-month appearance-none cursor-pointer hover:text-blue-500",value:Ut[Hn(s)],onChange:({target:{value:d}})=>a(Ut.indexOf(d)),children:Ut.map(d=>le("option",{value:d,children:d},d))}),le("button",{onClick:i,disabled:m,type:"button",className:"react-datepicker__navigation react-datepicker__navigation--previous","aria-label":"Previous Month",children:le("span",{className:"react-datepicker__navigation-icon react-datepicker__navigation-icon--previous",children:"Previous Month"})}),le("button",{onClick:c,disabled:b,type:"button",className:"react-datepicker__navigation react-datepicker__navigation--next","aria-label":"Next Month",children:le("span",{className:"react-datepicker__navigation-icon react-datepicker__navigation-icon--next",children:"Next Month"})})]}),customInput:Rn(In((s,l)=>le("button",y(g({},s),{ref:l,className:"block cursor-pointer appearance-none rounded-lg border border-gray-300 bg-gray-50 p-2 text-sm text-gray-900 focus:border-blue-500 focus:ring-blue-500",disabled:!e,children:e?e.toLocaleDateString("en-US",zn):"Loading"})))),showTimeInput:!0,timeInputLabel:"Time:",withPortal:!0,portalId:"__next"})})]}),Io=Vn;import{jsx as Qe,jsxs as Ro}from"react/jsx-runtime";var jn=({children:e,title:t,close:o})=>Qe("div",{className:"fixed inset-x-0 z-50 flex w-full items-center justify-center overflow-y-auto overflow-x-hidden bg-[rgba(0,0,0,0.5)] inset-0 h-full",children:Qe("div",{className:"relative w-full max-w-2xl p-4 md:h-auto",children:Ro("div",{className:"relative rounded-lg bg-black border-2 border-neutral-800",children:[Ro("div",{className:"flex items-start justify-between rounded-t border-b-2 border-neutral-800 p-4",children:[Qe("h3",{className:"text-xl font-semibold text-white capitalize",children:t}),Qe("button",{type:"button",className:"ml-auto inline-flex items-center rounded-lg bg-transparent p-1.5 text-sm text-neutral-700 hover:bg-neutral-800","data-modal-toggle":"defaultModal",onClick:o,children:Qe("svg",{className:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:Qe("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),e]})})}),ze=jn;import{encode as qn}from"js-base64";var ge=({message:e,owner:t,oid:o,name:r,branch:n})=>{let s=[],l=[],a=e!=null?e:"chore: Redevs commit",i="Automatically created by Redevs";return{setMessage:(u,p)=>{a=u!=null?u:a,i=p!=null?p:i},createInput:()=>({branch:{repositoryNameWithOwner:`${t}/${r}`,branchName:n},message:{headline:a},fileChanges:{additions:s,deletions:l},expectedHeadOid:o}),replaceFile:(u,p,h=!0)=>{let x=h===!0?qn(p):p;s.push({path:u,contents:x})},removeFile:u=>{l.push({path:u})}}};var Wn={"github.com":/.+\/([a-f0-9]+)$/},Ce=e=>e.indexOf("github.com")>=0?e.replace(Wn["github.com"],"$1"):"";import{useCallback as Gn}from"react";var Kn=()=>{var l;let{repoSlug:e,repoBranch:t,repoOwner:o}=L(),{session:r}=pe(),[n]=wo({variables:{owner:o||((l=r==null?void 0:r.user)==null?void 0:l.login)||"",name:e,branch:t},fetchPolicy:"no-cache"});return Gn(()=>A(void 0,null,function*(){var c,m,b,d,u;let{data:a,error:i}=yield n();if(i)throw i;if(((b=(m=(c=a==null?void 0:a.repository)==null?void 0:c.ref)==null?void 0:m.target)==null?void 0:b.__typename)!=="Commit")throw new Error("No valid oid found");if(typeof((u=(d=a.repository.ref.target.history.nodes)==null?void 0:d[0])==null?void 0:u.oid)!="string")throw new Error("Received a non-string oid");return a.repository.ref.target.history.nodes[0].oid}),[n])},ce=Kn;import{firstBy as Jn}from"thenby";import Zn from"json-stable-stringify";var Ae=e=>(e.metadata=e.metadata.sort(Jn("__outstatic.path")),Zn(e,{space:2}));import{Trash2 as Qn}from"lucide-react";import{useState as $o}from"react";import{Fragment as zo,jsx as Ee,jsxs as Be}from"react/jsx-runtime";var Yn=({slug:e,disabled:t=!1,onComplete:o=()=>{},collection:r,className:n})=>{var w;let[s,l]=$o(!1),[a,i]=$o(!1),{session:c}=pe(),[m]=ie(),{repoOwner:b,repoSlug:d,repoBranch:u,contentPath:p,monorepoPath:h}=L(),x=ce(),{data:f}=gt({variables:{owner:b||((w=c==null?void 0:c.user)==null?void 0:w.login)||"",name:d,filePath:`${u}:${h?h+"/":""}${p}/metadata.json`},fetchPolicy:"network-only"}),v=R=>A(void 0,null,function*(){var S,D,k,O,_;i(!0);try{let C=yield x(),F=b||((S=c==null?void 0:c.user)==null?void 0:S.login)||"",V=ge({message:`feat(${r}): remove ${R}`,owner:F,oid:C!=null?C:"",name:d,branch:u});if(V.removeFile(`${h?h+"/":""}${p}/${r}/${R}.md`),((k=(D=f==null?void 0:f.repository)==null?void 0:D.object)==null?void 0:k.__typename)==="Blob"){let P=JSON.parse((O=f.repository.object.text)!=null?O:"{}");P.generated=new Date().toISOString(),P.commit=Ce(f.repository.object.commitUrl);let Z=((_=P.metadata)!=null?_:[]).filter(j=>j.slug!==R);V.replaceFile(`${h?h+"/":""}${p}/metadata.json`,Ae(y(g({},P),{metadata:Z})))}let B=V.createInput();yield m({variables:{input:B}}),l(!1),o&&o()}catch(C){console.log(C)}});return Be(zo,{children:[Be("button",{onClick:()=>l(!0),type:"button",disabled:t,className:`inline-block text-neutral-300 hover:bg-neutral-800 focus:ring-4 focus:outline-none focus:ring-neutral-800 rounded-lg text-sm p-1.5 ${n}`,title:"Delete document",children:[Ee("span",{className:"sr-only",children:"Delete document"}),Ee(Qn,{})]}),s&&Be(ze,{title:"Delete Document",close:()=>l(!1),children:[Be("div",{className:"space-y-6 p-6 text-left",children:[Ee("p",{className:"text-base leading-relaxed text-neutral-500",children:"Are you sure you want to delete this document?"}),Ee("p",{className:"text-base leading-relaxed text-neutral-500",children:"This action cannot be undone."})]}),Be("div",{className:"flex items-center space-x-2 rounded-b border-t-2 border-neutral-800 p-6",children:[Ee("button",{type:"button",className:"flex rounded-lg bg-red-700 px-5 py-2.5 text-center text-sm font-medium text-white hover:bg-red-800 focus:outline-none",onClick:()=>{v(e)},children:a?Be(zo,{children:[Be("svg",{className:"mr-3 -ml-1 h-5 w-5 animate-spin text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[Ee("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),Ee("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Deleting"]}):"Delete"}),Ee("button",{type:"button",className:"rounded-lg border-2 border-neutral-800 px-5 py-2.5 text-sm font-medium focus:z-10 focus:outline-none focus:ring-4 bg-neutral-900 text-white hover:bg-neutral-800 focus:ring-neutral-700",onClick:()=>l(!1),children:"Cancel"})]})]})]})},yt=Yn;import{toast as Bo}from"sonner";var He=e=>{if(e.type.includes("image/")){if(e.size/1024/1024>20){Bo.error("File size too big (max 20MB).");return}}else{Bo.error("File type not supported.");return}let t=URL.createObjectURL(e),o=new FileReader;return o.readAsArrayBuffer(e),o.onloadend=()=>{let r=o.result,n=Buffer.from(r,"binary");Ke.getState().addFile({type:"image",blob:t,filename:e.name,content:n.toString("base64")})},t};import{useContext as Xn,useEffect as es,useState as Ye}from"react";import{Fragment as wt,jsx as oe,jsxs as Xe}from"react/jsx-runtime";function ts(e,t,o="."){var r=Array.isArray(e)?e:e.split(o);return[...r].reduce((n,s)=>n==null?void 0:n[s],t)}var os=({name:e,description:t,label:o})=>{let{document:r,editDocument:n}=Xn(De),[s,l]=Ye(!1),[a,i]=Ye(!1),[c,m]=Ye(!1),[b,d]=Ye(!0),[u,p]=Ye(!1),[h,x]=Ye(""),f=ts(e,r);es(()=>{let w=f==null?void 0:f.replace(`/${Pe}`,`/${Ue}`);x(w||""),i(!f),l(!!f)},[f]);let v=R=>A(void 0,[R],function*({currentTarget:w}){var S,D;if((S=w.files)!=null&&S.length&&((D=w.files)==null?void 0:D[0])!==null){let k=w.files[0],O=He(k);n(e,O)}});return Xe(wt,{children:[u&&oe("div",{className:"p-4 mb-4 text-sm text-red-700 bg-red-100 rounded-lg dark:bg-red-200 dark:text-red-800",role:"alert",children:"The image failed to load, try submitting again."}),s&&Xe(wt,{children:[oe("div",{className:"mb-1 block text-sm font-medium text-white",children:t}),Xe("div",{className:`w-full relative bg-slate-100 ${b?"h-48":""}`,children:[b&&oe("div",{className:"animate-pulse w-full h-48 bg-slate-200 absolute"}),oe("img",{src:h,className:"w-full max-h-48 object-contain",onLoad:()=>{m(!1),d(!1),p(!1)},onError:()=>{d(!1),p(!0),n(e,""),m(!1)},alt:t})]}),oe("div",{className:"w-full flex justify-between mt-2",children:oe("button",{onClick:()=>{n(e,""),l(!1),m(!1)},className:"rounded-lg border border-red-700 bg-red-700 px-5 py-2.5 text-center text-sm font-medium text-white hover:bg-red-800 focus:outline-none",children:"Remove"})})]}),c&&Xe(wt,{children:[oe("label",{className:"text-white text-sm mb-1 font-medium",children:`${t} URL`}),oe(ne,{name:e,id:e,defaultValue:f,inputSize:"small",helperText:"Remember to save the document after adding the image URL",onBlur:w=>{w.target.value&&(d(!0),m(!1),n(e,w.target.value))}}),oe("div",{className:"w-full flex justify-between mt-2",children:oe("button",{onClick:()=>{m(!1),i(!0)},type:"button",className:"rounded-lg bg-neutral-800 px-5 py-2.5 text-sm font-medium text-white hover:bg-neutral-700 focus:z-10 focus:outline-none focus:ring-4 focus:ring-neutral-700",children:"Cancel"})})]}),a&&Xe(wt,{children:[oe("span",{className:"mb-1 block text-sm font-medium text-white",children:o!=null?o:"Add an image"}),Xe("div",{className:"w-full flex justify-between mt-2",children:[oe("button",{onClick:()=>{m(!0),i(!1),l(!1),p(!1)},type:"button",className:"flex rounded-lg bg-neutral-800 px-5 py-2.5 text-sm font-medium text-white hover:bg-neutral-700 focus:outline-none focus:ring-4 focus:ring-neutral-700 disabled:cursor-not-allowed disabled:bg-neutral-600 md:mb-2",children:"From link"}),oe("label",{htmlFor:`${e}-upload`,className:"flex rounded-lg bg-neutral-800 px-5 py-2.5 text-sm font-medium text-white hover:bg-neutral-700 focus:outline-none focus:ring-4 focus:ring-neutral-700 disabled:cursor-not-allowed disabled:bg-neutral-600 md:mb-2",children:"From file"}),oe("input",{type:"file",accept:"image/*",id:`${e}-upload`,onChange:v,className:"hidden"})]})]})]})},jt=os;import rs from"camelcase";import{useState as ns}from"react";import{Controller as ss,useFormContext as as}from"react-hook-form";import is from"react-select/creatable";import{Fragment as cs,jsx as Te,jsxs as _o}from"react/jsx-runtime";var Ho={small:{label:"mb-1 block text-sm font-medium text-gray-900",input:"w-full rounded-lg border border-gray-300 bg-gray-50 p-2 text-sm text-gray-900 outline-none focus:border-blue-500 focus:ring-blue-500"},medium:{label:"block mb-2 text-sm font-medium text-gray-900",input:"w-full text-gray-900 bg-gray-50 rounded-lg border border-gray-300 sm:text-sm outline-none focus:ring-blue-500 focus:border-blue-500"}},ls=a=>{var i=a,{label:e,helperText:t,id:o,wrapperClass:r,inputSize:n="medium",suggestions:s=[]}=i,l=W(i,["label","helperText","id","wrapperClass","inputSize","suggestions"]);var f,v,w,R;let{control:c,getValues:m,setValue:b,formState:{errors:d}}=as(),[u,p]=ns(s),h=S=>({label:S,value:rs(S)}),x=S=>{let D=h(S);p(O=>[...O,D]);let k=m(o)||[];b(o,[...k,D])};return _o("div",{className:r,children:[e&&Te("label",{htmlFor:o,className:`${Ho[n].label} first-letter:capitalize`,children:e}),Te("div",{className:"relative",children:Te(ss,{name:o,control:c,render:({field:S})=>Te(is,g(y(g({},S),{options:u,isMulti:!0,className:d.multiSelect?"is-invalid":"",styles:{control:(D,k)=>y(g({},D),{borderColor:k.isFocused?"focus:ring-blue-500":"border-gray-300 bg-gray-50",borderRadius:"0.375rem",backgroundColor:"#f9fafb",fontSize:"0.875rem"})},classNames:{menu:()=>n==="small"?"text-sm":"text-base",control:()=>Ho[n].input,valueContainer:()=>"p-2"},onCreateOption:x,isClearable:!1}),l))})}),Te("div",{className:"flex flex-wrap"}),Te(cs,{children:(((f=d[o])==null?void 0:f.message)||t)&&_o("div",{className:"mt-1 first-letter:capitalize",children:[t&&Te("p",{className:"text-xs text-gray-500",children:t}),((v=d[o])==null?void 0:v.message)&&Te("span",{className:"text-sm text-red-500",children:(R=(w=d[o])==null?void 0:w.message)==null?void 0:R.toString()})]})})]})},Ct=ls;import{useFormContext as ms}from"react-hook-form";import{jsx as lt,jsxs as Vo}from"react/jsx-runtime";function Nt(c){var m=c,{label:e,placeholder:t="",helperText:o,id:r,type:n="text",readOnly:s=!1,registerOptions:l,wrapperClass:a}=m,i=W(m,["label","placeholder","helperText","id","type","readOnly","registerOptions","wrapperClass"]);var u,p,h;let{register:b,formState:{errors:d}}=ms();return Vo("div",{className:a,children:[e&&lt("label",{htmlFor:r,className:"mb-1 block text-sm font-medium text-gray-900",children:e}),lt("div",{className:"relative",children:lt("textarea",y(g(g({},b(r,l)),i),{name:r,id:r,readOnly:s,placeholder:t,"aria-describedby":r,className:"block w-full rounded-lg border border-gray-300 bg-gray-50 p-2 text-sm text-gray-900 outline-none focus:border-blue-500 focus:ring-blue-500"}))}),Vo("div",{className:"mt-1",children:[o&&lt("p",{className:"text-xs text-gray-500",children:o}),((u=d[r])==null?void 0:u.message)&&lt("span",{className:"text-sm text-red-500",children:(h=(p=d[r])==null?void 0:p.message)==null?void 0:h.toString()})]})]})}import{PanelRight as us,PanelRightClose as ds}from"lucide-react";import{useRouter as ps}from"next/navigation";import{useContext as fs,useState as gs}from"react";import{useFormContext as hs}from"react-hook-form";import{slugify as bs}from"transliteration";import{Fragment as qt,jsx as I,jsxs as K}from"react/jsx-runtime";var xs={String:{component:ne,props:{type:"text"}},Text:{component:Nt,props:{}},Number:{component:ne,props:{type:"number"}},Tags:{component:Ct,props:{suggestions:[]}}},vs=({saveFunc:e,loading:t,registerOptions:o,showDelete:r,customFields:n={}})=>{var p,h;let{register:s,formState:{errors:l}}=hs(),a=ps(),{document:i,editDocument:c,hasChanges:m,collection:b}=fs(De),[d,u]=gs(!1);return K(qt,{children:[K("div",{className:"absolute w-full items-center justify-between flex p-4 border-t-2 border-neutral-800 z-10 bottom-0 bg-black text-white md:hidden",children:[I("button",{onClick:()=>u(!d),className:"ml-1 inline-flex items-center rounded-lg p-2 text-sm text-neutral-800 hover:ring-2 ring-neutral-800 focus:outline-none focus:ring-2 focus:ring-neutral-800 md:hidden",children:d?I(ds,{}):I(us,{})}),K("div",{className:"flex flex-end w-full items-center justify-end gap-4",children:[I("label",{htmlFor:"status",className:"sr-only",children:"Status"}),K("select",y(g({},s("status",o)),{name:"status",id:"status",defaultValue:i.status,className:"block cursor-pointer appearance-none rounded-lg bg-gray-50 p-2 py-2.5 text-sm text-gray-900 outline-none focus:border-neutral-700 focus:ring-border-neutral-700",children:[I("option",{value:"draft",children:"Draft"}),I("option",{value:"published",children:"Published"})]})),I("button",{onClick:e,type:"button",disabled:t||!m,className:"flex rounded-lg bg-neutral-800 px-5 py-2.5 text-sm font-medium text-white hover:bg-neutral-700 focus:outline-none focus:ring-4 focus:ring-neutral-700 disabled:cursor-not-allowed disabled:bg-neutral-900",children:t?K(qt,{children:[K("svg",{className:"mr-3 -ml-1 h-5 w-5 animate-spin text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[I("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),I("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving"]}):"Save"})]})]}),K("aside",{className:`${d?"block absolute":"hidden relative"} md:block w-full text-white bg-neutral-900 md:w-64 md:flex-none md:flex-col md:flex-wrap md:items-start md:justify-start py-6 h-full max-h-[calc(100vh-128px)] md:max-h-[calc(100vh-53px)] scrollbar-hide overflow-scroll`,children:[I("div",{className:"relative w-full items-center justify-between mb-4 flex px-4",children:I(Io,{id:"publishedAt",label:"Date",date:i.publishedAt,setDate:x=>c("publishedAt",x)})}),K("div",{className:"hidden md:flex relative w-full items-center justify-between mb-4 px-4",children:[I("label",{htmlFor:"status",className:"block text-sm font-medium text-white",children:"Status"}),K("select",y(g({},s("status",o)),{name:"status",id:"status",defaultValue:i.status,className:"block cursor-pointer appearance-none rounded-lg border border-gray-300 bg-gray-50 p-2 text-sm text-gray-900 outline-none focus:border-neutral-700 focus:ring-border-neutral-700",children:[I("option",{value:"draft",children:"Draft"}),I("option",{value:"published",children:"Published"})]}))]}),K("div",{className:`flex w-full pb-4 px-4 ${r?"justify-between items-center":"justify-end"}`,children:[r&&I(yt,{disabled:t,slug:i.slug,onComplete:()=>{a.push(`/redevs/${b}`)},collection:b,className:"hover:bg-black max-h-[2.25rem]"}),I("button",{onClick:e,type:"button",disabled:t||!m,className:"hidden md:flex rounded-lg bg-neutral-800 px-5 py-2.5 text-sm font-medium text-white hover:bg-neutral-700 focus:outline-none focus:ring-4 focus:ring-neutral-700 disabled:cursor-not-allowed disabled:bg-black",children:t?K(qt,{children:[K("svg",{className:"mr-3 -ml-1 h-5 w-5 animate-spin text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[I("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),I("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving"]}):"Save"})]}),K("div",{className:"w-full",children:[K(Ze,{title:"Author",children:[I("label",{className:"text-white text-sm mb-1 font-medium",children:"Name"}),I(ne,{name:"author.name",id:"author.name",defaultValue:(h=(p=i.author)==null?void 0:p.name)!=null?h:"",inputSize:"small",wrapperClass:"mb-4"}),I("label",{className:"text-white text-sm mb-1 font-medium",children:"Add an avatar"}),I(jt,{name:"author.picture",description:"Author Avatar"})]}),K(Ze,{title:"URL Slug",children:[I("label",{className:"text-white text-sm mb-1 font-medium",children:"Write a slug (optional)"}),I(ne,{name:"slug",id:"slug",defaultValue:i.slug,inputSize:"small",registerOptions:{onChange:x=>{let f=x.target.value.slice(-1);c("slug",f===" "||f==="-"?x.target.value:bs(x.target.value,{allowedChars:"a-zA-Z0-9"}))}}})]}),K(Ze,{title:"Description",children:[I("label",{className:"text-white text-sm mb-1 font-medium",children:"Write a description (optional)"}),I(Nt,{name:"description",type:"textarea",id:"description",rows:5,className:"block w-full rounded-lg border border-gray-300 bg-gray-50 p-2 text-sm text-gray-900 outline-none focus:border-neutral-700 focus:ring-border-neutral-700"})]}),I(Ze,{title:"Cover Image",children:I(jt,{name:"coverImage",description:"Cover Image"})}),n&&Object.entries(n).map(([x,f])=>{var w;let v=xs[f.fieldType];return st(f)&&(v.props.suggestions=f.values),f.fieldType==="Number"&&!f.required&&(v.props=y(g({},v.props),{registerOptions:{setValueAs:R=>isNaN(R)?void 0:Number(R)}})),I(Ze,{title:`${f.title}${f.required?"*":""}`,error:!!((w=l[x])!=null&&w.message),children:I(v.component,g({id:x,label:f.description},v.props))},x)})]})]})]})},Wt=vs;import{useContext as ys}from"react";import{useFormContext as ws}from"react-hook-form";import Cs from"react-textarea-autosize";import{slugify as Ns}from"transliteration";import{jsx as kt,jsxs as Uo}from"react/jsx-runtime";function St(a){var i=a,{label:e,placeholder:t="",helperText:o,id:r,readOnly:n=!1,wrapperClass:s}=i,l=W(i,["label","placeholder","helperText","id","readOnly","wrapperClass"]);var u,p,h;let{register:c,formState:{errors:m},setValue:b}=ws(),{editor:d}=ys(De);return Uo("div",{className:s,children:[kt("div",{className:"relative",children:kt(Cs,y(g(g({},c(r,{onChange:x=>{let f=new URL(document.location.href).pathname.split("/");(f.pop()||f.pop())==="new"&&b("slug",Ns(x.target.value,{allowedChars:"a-zA-Z0-9"}))}})),l),{name:r,id:r,readOnly:n,placeholder:t,"aria-describedby":r,autoFocus:!0,onKeyDown:x=>{x.key.toLowerCase()==="enter"&&(x.preventDefault(),d.commands.focus("start"))}}))}),Uo("div",{className:"mt-1",children:[o&&kt("p",{className:"text-xs text-gray-500",children:o}),((u=m[r])==null?void 0:u.message)&&kt("span",{className:"text-sm text-red-500",children:(h=(p=m[r])==null?void 0:p.message)==null?void 0:h.toString()})]})]})}import{DndContext as ks,useDroppable as Ss}from"@dnd-kit/core";import{restrictToParentElement as Ms}from"@dnd-kit/modifiers";import{SortableContext as Ps,arrayMove as Ds,rectSortingStrategy as As,useSortable as Es}from"@dnd-kit/sortable";import{CSS as Ts}from"@dnd-kit/utilities";import{GripVertical as Os}from"lucide-react";import Ls,{components as ct}from"react-select";import{jsx as de,jsxs as Hs}from"react/jsx-runtime";var Fs=e=>{let t=c=>{c.preventDefault(),c.stopPropagation()},o=y(g({},e.innerProps),{onMouseDown:t}),{attributes:r,listeners:n,setNodeRef:s,transform:l,transition:a}=Es({id:e.data.id});l&&(l.scaleX=1,l.scaleY=1);let i={transform:Ts.Transform.toString(l),transition:a};return de("div",y(g(g({style:i,ref:s},r),n),{children:de(ct.MultiValue,y(g({},e),{innerProps:o}))}))},Is=e=>Hs("div",{className:"flex cursor-pointer items-center pl-1",children:[de(Os,{size:15}),de(ct.MultiValueLabel,g({},e))]}),Rs=e=>{let{setNodeRef:t}=Ss({id:"droppable"});return de("div",{ref:t,children:de(ct.Control,g({},e))})},$s=e=>de(ct.MultiValueContainer,g({},e)),zs=e=>de(ct.MultiValueRemove,y(g({},e),{innerProps:g({onPointerDown:t=>t.stopPropagation()},e.innerProps)})),Bs=({selected:e,setSelected:t,defaultValues:o,allOptions:r,onChangeList:n,onBlur:s})=>de(ks,{modifiers:[Ms],onDragEnd:i=>{let{active:c,over:m}=i;!c||!m||t(b=>{let d=b.findIndex(h=>h.id===c.id),u=b.findIndex(h=>h.id===m.id),p=Ds(b,d,u);return n(p),p})},children:de(Ps,{items:e,strategy:As,children:de(Ls,{isMulti:!0,defaultValue:o,options:r,value:e,onChange:i=>{t([...i]),n(i)},components:{MultiValue:Fs,MultiValueLabel:Is,MultiValueContainer:$s,MultiValueRemove:zs,Control:Rs},isClearable:!1,escapeClearsValue:!1,closeMenuOnSelect:!1,onBlur:s,autoFocus:!0,classNamePrefix:"rounded-md bg-black text-neutral-300 ",styles:{control:i=>y(g({},i),{borderRadius:"0.375rem",borderWidth:"2px",borderColor:"#262626",boxShadow:"none",backgroundColor:"black",color:"white"}),menu:i=>y(g({},i),{borderRadius:"0.375rem",borderWidth:"2px",borderColor:"#262626",boxShadow:"none",backgroundColor:"black"})},theme:i=>y(g({},i),{borderRadius:0,colors:y(g({},i.colors),{primary:"white"})})})})}),jo=Bs;import{sentenceCase as _s}from"change-case";import qo from"js-cookie";import{Settings as Vs}from"lucide-react";import Us from"next/link";import{useState as Gt}from"react";import{jsx as Y,jsxs as mt}from"react/jsx-runtime";var Wo=[{id:"title",label:"Title",value:"title"},{id:"status",label:"Status",value:"status"},{id:"publishedAt",label:"Published at",value:"publishedAt"}],js=e=>{var i;let t=Object.keys(e.documents[0]).map(c=>({id:c,label:_s(c),value:c})),[o,r]=Gt(e.documents),[n,s]=Gt((i=JSON.parse(qo.get(`ost_${e.collection}_fields`)||"null"))!=null?i:Wo),[l,a]=Gt(!1);return mt("div",{children:[mt("table",{className:"bg-black w-full text-left text-sm text-neutral-200",children:[Y("thead",{className:"bg-black text-xs uppercase text-neutral-300 border-b-2 border-neutral-800",children:mt("tr",{children:[n.map(c=>Y("th",{scope:"col",className:"px-6 py-3",children:c.label},c.value)),Y("th",{scope:"col",className:"px-8 py-2 text-right flex justify-end items-center",children:Y("button",{onClick:()=>a(!l),children:Y(Vs,{})})})]})}),Y("tbody",{children:o&&o.map(c=>mt("tr",{className:"border-b-2 border-neutral-800 bg-black hover:bg-neutral-950",children:[n.map(m=>qs(m.value,c,e.collection)),Y("td",{className:"pr-6 py-4 text-right text-neutral-400",children:Y(yt,{slug:c.slug,disabled:!1,onComplete:()=>r(o.filter(m=>m.slug!==c.slug)),collection:e.collection})})]},c.slug))})]}),l&&Y("div",{className:"absolute -top-12 max-w-full min-w-min capitalize right-0",children:Y(jo,{selected:n,setSelected:s,allOptions:t,defaultValues:Wo,onChangeList:c=>{qo.set(`ost_${e.collection}_fields`,JSON.stringify(c))},onBlur:()=>a(!1)})})]})},qs=(e,t,o)=>{let r=t[e];switch(e){case"title":return Y("th",{scope:"row",className:"relative whitespace-nowrap px-6 py-4 text-base font-semibold text-neutral-200 group",children:Y(Us,{href:`/redevs/${o}/${t.slug}`,children:mt("div",{className:"group-hover:text-white",children:[r,Y("div",{className:"absolute top-0 bottom-0 left-0 right-40 cursor-pointer"})]})})},"title");default:return Y("td",{className:"px-6 py-4 text-base font-semibold text-neutral-200",children:typeof r=="object"&&r!==null?r.map(n=>Y("span",{className:"bg-black text-neutral-200 font-medium me-2 px-2.5 py-0.5 rounded",children:n.label},n.label)):r},e)}},Kt=js;import{jsx as Ks}from"react/jsx-runtime";var Ws={success:"text-green-700 bg-green-100",info:"bg-amber-100 text-amber-800",error:"text-red-700 bg-red-100",warning:"text-yellow-700 bg-yellow-100"},Gs=({type:e,children:t})=>Ks("div",{className:`inline-block p-4 mb-4 text-sm rounded-lg ${Ws[e]}`,role:"alert",children:t}),Oe=Gs;var Js=({file:e,skip:t=!1})=>{var c;let{repoOwner:o,repoSlug:r,repoBranch:n,contentPath:s,monorepoPath:l}=L(),{session:a}=pe();return gt({variables:{owner:o||((c=a==null?void 0:a.user)==null?void 0:c.login)||"",name:r,filePath:`${n}:${l?l+"/":""}${s}/${e}`},fetchPolicy:"network-only",skip:t})},Le=Js;import{yupResolver as Zs}from"@hookform/resolvers/yup";import Go from"camelcase";import{useEffect as Ko,useState as Fe}from"react";import{FormProvider as Qs,useForm as Ys}from"react-hook-form";import*as Ie from"yup";import{Fragment as et,jsx as N,jsxs as T}from"react/jsx-runtime";var Jo={Text:"string",String:"string",Number:"number",Tags:"array"};function Jt({collection:e}){let{contentPath:t,monorepoPath:o,session:r,repoSlug:n,repoBranch:s,repoOwner:l,setHasChanges:a}=L(),[i]=ie(),c=ce(),[m,b]=Fe({}),d=Ie.object().shape({title:Ie.string().matches(/^[aA-zZ\s]+$/,"Only alphabets are allowed for this field.").required("Custom field name is required."),fieldType:Ie.string().oneOf([...Lt]).required(),description:Ie.string(),required:Ie.boolean().required()}),[u,p]=Fe(!1),[h,x]=Fe(""),f=Ys({mode:"onChange",resolver:Zs(d)}),[v,w]=Fe(!1),[R,S]=Fe(!1),[D,k]=Fe(!1),{data:O,loading:_}=Le({file:`${e}/schema.json`}),[C,F]=Fe(""),[V,B]=Fe(""),P=ae=>A(this,[ae],function*({customFields:M,deleteField:$=!1}){var ue;let ke=yield c(),Se=JSON.stringify({title:e,type:"object",properties:g({},M)},null,2),q=ge({message:`feat(${e}): ${$?"delete":"add"} ${V} field`,owner:l||((ue=r==null?void 0:r.user)==null?void 0:ue.login)||"",oid:ke!=null?ke:"",name:n,branch:s});q.replaceFile(`${o?o+"/":""}${t}/${e}/schema.json`,Se+`
`);let X=q.createInput();return yield i({variables:{input:X}})}),Z=M=>A(this,null,function*(){p(!0);let q=M,{title:$,fieldType:ae}=q,ke=W(q,["title","fieldType"]),Se=Go($);if(!C&&m[Se]){f.setError("title",{type:"manual",message:"Field name is already taken."}),p(!1);return}try{m[Se]=y(g({},ke),{fieldType:ae,dataType:Jo[ae],title:M.title}),Jo[ae]==="array"&&(m[Se]=y(g({},m[Se]),{values:(M==null?void 0:M.values)||[]})),(yield P({customFields:m}))&&b(g({},m))}catch(X){x("add"),console.log({error:X})}a(!1),F(""),w(!1),p(!1)}),j=M=>A(this,null,function*(){k(!0);try{let $=g({},m);delete $[M],(yield P({customFields:$,deleteField:!0}))&&b($)}catch($){x("delete"),console.log({error:$})}F(""),S(!1),k(!1),a(!1)});return Ko(()=>{var $;let M=($=O==null?void 0:O.repository)==null?void 0:$.object;if((M==null?void 0:M.__typename)==="Blob"){let ae=JSON.parse((M==null?void 0:M.text)||"{}");b(ae.properties)}},[O]),Ko(()=>{let M=f.watch(()=>a(!0));return()=>M.unsubscribe()},[f]),N(te,{title:"Add Custom Fields",children:T(Qs,y(g({},f),{children:[T("div",{className:"mb-8 flex h-12 items-center",children:[T("h1",{className:"mr-12 text-2xl",children:[N("span",{className:"capitalize",children:e})," Fields"]}),Object.keys(m).length>0?N("button",{type:"button",onClick:()=>{f.reset(),w(!0)},children:N("div",{className:"cursor-pointer rounded-lg px-5 py-2.5 text-sm font-medium focus:outline-none focus:ring-4 bg-neutral-800 hover:bg-neutral-800/90 text-white hover:border hover:border-neutral-800 focus:ring-neutral-700 no-underline",children:"Add Custom Field"})}):null]}),_?null:N(et,{children:Object.keys(m).length===0?N("div",{className:"max-w-2xl",children:N("div",{className:"relative",children:T("div",{className:"mb-20 max-w-2xl p-8 px-4 md:p-8 text-white bg-black rounded-lg border-2 border-neutral-800 shadow-md prose prose-base",children:[N("p",{children:"Here you can add Custom Fields to your collections."}),N("p",{children:"Create your first Custom Field by clicking the button below."}),N("div",{className:"inline-block rounded-lg px-5 py-2.5 text-sm font-medium focus:outline-none focus:ring-4  bg-neutral-800 text-white hover:scale-105 focus:ring-neutral-800 no-underline hover:cursor-pointer",onClick:()=>w(!0),children:"Add Custom Field"}),T("p",{children:["To learn more about how Custom Fields work checkout"," ",N("a",{href:"https://outstatic.com/docs/custom-fields",target:"_blank",rel:"noreferrer",className:"text-neutral-300",children:"the docs"}),"."]})]})})}):N(et,{children:N("div",{className:"max-w-5xl w-full grid grid-cols-3 gap-6",children:m&&Object.entries(m).map(([M,$])=>T("div",{className:"relative flex p-6 justify-between items-center max-w-sm bg-neutral-900 rounded-lg border-2 border-neutral-800 shadow-md hover:bg-neutral-800 text-white",children:[T("button",{type:"button",onClick:()=>{f.reset(),F(M),w(!0)},className:"text-left",children:[T("span",{className:"block text-xl cursor-pointer font-bold tracking-tight text-white capitalize mb-2",children:[$.title,N("span",{className:"absolute top-0 bottom-0 left-0 right-16"})]}),N("span",{className:"bg-blue-100 text-blue-800 text-sm font-medium mr-2 px-2.5 py-0.5 rounded",children:$.fieldType}),$.required?N("span",{className:"bg-red-100 text-red-800 text-sm font-medium mr-2 px-2.5 py-0.5 rounded",children:"required"}):null]}),T("button",{className:"z-10 inline-block text-neutral-500 hover:bg-black focus:outline-none focus:bg-neutral-950 rounded-lg text-sm p-1.5",type:"button",onClick:()=>{S(!0),F(M)},children:[N("span",{className:"sr-only",children:"Delete content"}),T("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24",children:[N("path",{fill:"none",d:"M0 0h24v24H0z"}),N("path",{fill:"#e5e5e5",d:"M17 6h5v2h-2v13a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V8H2V6h5V3a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v3zm1 2H6v12h12V8zm-9 3h2v6H9v-6zm4 0h2v6h-2v-6zM9 4v2h6V4H9z"})]})]})]},M))})})}),h?N("div",{className:"mt-8",children:N(Oe,{type:"error",children:T(et,{children:[N("span",{className:"font-medium",children:"Oops!"})," We are unable to"," ",h," your custom field."]})})}):null,v&&N(ze,{title:C?`Edit ${m[C].title}`:`Add Custom Field to ${e}`,close:()=>{a(!1),F(""),w(!1)},children:T("form",{onSubmit:f.handleSubmit(Z),children:[C?N("div",{className:"pt-6 pl-6",children:N(Oe,{type:"info",children:T(et,{children:[N("span",{className:"font-medium",children:"Field name"})," and"," ",N("span",{className:"font-medium",children:"Field type"})," editing is disabled to avoid data conflicts."]})})}):null,T("div",{className:`flex p-6 text-left gap-4 ${C?"pt-0 opacity-50 cursor-not-allowed pointer-events-none hidden":""}`,children:[T("div",{children:[N("label",{className:"block mb-2 text-sm font-medium text-neutral-300",children:"Field name"}),N(ne,{id:"title",inputSize:"medium",className:"w-full max-w-sm md:w-80 focus:border-neutral-800",placeholder:"Ex: Category",type:"text",helperText:"The name of the field",readOnly:!!C,autoFocus:!C,defaultValue:C?m[C].title:"",registerOptions:{onChange:M=>{B(Go(M.target.value))}}})]}),T("div",{className:"mb-5",children:[N("label",{htmlFor:"status",className:"block mb-2 text-sm font-medium text-neutral-300",children:"Field type"}),N("select",y(g({},f.register("fieldType")),{name:"fieldType",id:"fieldType",className:"block cursor-pointer appearance-none rounded-lg bg-gray-50 p-2 text-sm text-gray-900 outline-none focus:border-neutral-800",defaultValue:C?m[C].fieldType:"String",children:Lt.map(M=>N("option",{value:M,disabled:!!C,children:M},M))}))]})]},C),T("div",{className:"flex px-6 text-left gap-4 mb-4",children:[T("div",{children:[N("label",{className:"block mb-2 text-sm font-medium text-neutral-300",children:"Description"}),N(ne,{id:"description",inputSize:"medium",className:"w-full max-w-sm md:w-80 focus:border-neutral-800",placeholder:"Ex: Add a category",type:"text",helperText:"This will be the label of the field",defaultValue:C?m[C].description:""})]}),N("fieldset",{children:T("div",{className:"flex mt-7",children:[N("div",{className:"flex items-center h-5",children:N("input",y(g({},f.register("required")),{id:"required",type:"checkbox",className:"cursor-pointer w-4 h-4 text-neutral-800 bg-neutral-100 rounded border-neutral-800 focus:ring-neutral-800 focus:ring-2",defaultChecked:C?m[C].required:!1}))}),T("div",{className:"ml-2 text-sm",children:[N("label",{htmlFor:"required",className:"cursor-pointer text-sm font-medium text-neutral-300",children:"Required field"}),T("p",{id:"helper-checkbox-text",className:"text-xs font-normal text-gray-500",children:[N("span",{className:"capitalize",children:e})," ","documents will only be saved if this field is not empty"]})]})]})})]}),C&&m[C].fieldType==="Tags"&&m[C].dataType==="array"?N("div",{className:"flex px-6 text-left gap-4 mb-4",children:T("div",{children:[N("label",{className:"block mb-2 text-sm font-medium text-neutral-300",children:"Your tags"}),N(Ct,{id:"values",helperText:"Deleting tags will remove them from suggestions, not from existing documents.",defaultValue:m[C].values||[],noOptionsMessage:()=>null,isClearable:!1,isSearchable:!1,components:{DropdownIndicator:()=>null,IndicatorSeparator:()=>null}})]})}):null,T("div",{className:"space-x-2 rounded-b border-t-2 border-neutral-800 p-6 text-sm text-neutral-300",children:["This field will be accessible on the frontend as:","  ",N("code",{className:"text-neutral-400 font-semibold",children:C||V})]}),T("div",{className:"flex items-center space-x-2 rounded-b border-t-2 border-neutral-800 p-6",children:[N("button",{type:"submit",disabled:u,className:"flex rounded-lg bg-red-700 px-5 py-2.5 text-center text-sm font-medium text-white hover:bg-red-800 focus:outline-none",children:u?T(et,{children:[T("svg",{className:"mr-3 -ml-1 h-5 w-5 animate-spin text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[N("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),N("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),C?"Editing":"Adding"]}):C?"Edit":"Add"}),N("button",{type:"button",className:"rounded-lg px-5 py-2.5 text-sm font-medium focus:z-10 focus:outline-none focus:ring-4 bg-neutral-900 text-white hover:bg-neutral-800 focus:ring-neutral-700",onClick:()=>{a(!1),F(""),w(!1)},children:"Cancel"})]})]})}),R&&T(ze,{title:`Delete ${m[C].title} Field`,close:()=>{S(!1),F("")},children:[T("div",{className:"space-y-6 p-6 text-left",children:[T("p",{className:"text-base leading-relaxed text-gray-500",children:["Are you sure you want to delete the"," ",m[C].title," field?"]}),N("p",{className:"text-base leading-relaxed text-gray-500",children:"This action cannot be undone."})]}),T("div",{className:"flex items-center space-x-2 rounded-b border-t-2 border-neutral-800 p-6",children:[N("button",{type:"button",disabled:D,className:"flex rounded-lg bg-red-700 px-5 py-2.5 text-center text-sm font-medium text-white hover:bg-red-800 focus:outline-none",onClick:()=>{k(!0),j(C)},children:D?T(et,{children:[T("svg",{className:"mr-3 -ml-1 h-5 w-5 animate-spin text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[N("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),N("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Deleting"]}):"Delete"}),N("button",{type:"button",className:"rounded-lg px-5 py-2.5 text-sm font-medium focus:z-10 focus:outline-none focus:ring-4 bg-neutral-900 text-white hover:bg-neutral-800 focus:ring-neutral-700",onClick:()=>{S(!1),F("")},children:"Cancel"})]})]})]}))})}import Mt from"next/link";import{useState as Zt}from"react";import{Fragment as Zo,jsx as z,jsxs as G}from"react/jsx-runtime";function Qt(){var v;let{repoOwner:e,collections:t,session:o,repoSlug:r,repoBranch:n,contentPath:s,monorepoPath:l,removePage:a}=L(),[i,c]=Zt(!1),[m,b]=Zt(""),[d,u]=Zt(!1),[p]=ie(),h=ce(),[x]=xo({variables:{owner:e||((v=o==null?void 0:o.user)==null?void 0:v.login)||"",name:r,filePath:`${n}:${l?l+"/":""}${s}/metadata.json`},fetchPolicy:"network-only"}),f=w=>A(this,null,function*(){x().then(S=>A(this,[S],function*({data:R}){var D,k,O,_,C;try{let F=yield h(),V=e||((D=o==null?void 0:o.user)==null?void 0:D.login)||"",B=ge({message:`feat(${w}): remove ${w}`,owner:V,oid:F!=null?F:"",name:r,branch:n});if(B.removeFile(`${l?l+"/":""}${s}/${w}`),((O=(k=R==null?void 0:R.repository)==null?void 0:k.object)==null?void 0:O.__typename)==="Blob"){let Z=JSON.parse((_=R.repository.object.text)!=null?_:"{}");Z.generated=new Date().toISOString(),Z.commit=Ce(R.repository.object.commitUrl);let j=((C=Z.metadata)!=null?C:[]).filter(M=>M.collection!==w);B.replaceFile(`${l?l+"/":""}${s}/metadata.json`,Ae(y(g({},Z),{metadata:j})))}let P=B.createInput();yield p({variables:{input:P}}),c(!1),u(!1),a(w)}catch(F){}}))});return G(te,{title:"Collections",children:[t.length===0?z("div",{className:"max-w-2xl",children:G("div",{className:"relative",children:[z("div",{className:"mb-8 flex h-12 items-center",children:z("h1",{className:"mr-12 text-2xl",children:"Welcome to Redevs!"})}),G("div",{className:"mb-20 max-w-2xl p-8 px-4 md:p-8 text-white bg-black rounded-lg border-2 border-neutral-800 shadow-md prose prose-base",children:[z("p",{children:"To get started you will need to create a new Collection. Collections are the main building block of your Redevs website."}),z("p",{children:"Create your first Collection by clicking the button below."}),z(Mt,{href:"/redevs/collections/new",children:z("div",{className:"inline-block rounded-lg px-5 py-2.5 text-sm font-medium focus:outline-none focus:ring-4 bg-neutral-800 hover:bg-neutral-800/90 text-white hover:border-2 hover:border-neutral-800 focus:ring-neutral-700 no-underline",children:"New Collection"})}),G("p",{children:["To learn more about how Collections work"," ",z("a",{href:"https://outstatic.com/docs/introduction#what-are-collections",target:"_blank",rel:"noreferrer",children:"click here"}),"."]})]})]})}):G(Zo,{children:[G("div",{className:"mb-8 flex h-12 items-center",children:[z("h1",{className:"mr-12 text-2xl",children:"Collections"}),z(Mt,{href:"/redevs/collections/new",children:z("div",{className:"cursor-pointer rounded-lg px-5 py-2.5 text-sm font-medium focus:outline-none focus:ring-4 bg-neutral-800 hover:bg-neutral-800/90 text-white hover:border hover:border-neutral-800 focus:ring-neutral-700 no-underline",children:"New Collection"})})]}),z("div",{className:"max-w-5xl w-full grid md:grid-cols-3 gap-6",children:t.map(w=>G("div",{className:"relative flex p-6 justify-between items-center max-w-sm bg-neutral-900 rounded-lg border-2 border-neutral-800 shadow-md hover:bg-neutral-800",children:[z(Mt,{href:`/redevs/${w}`,className:"focus:ring-4 focus:outline-none focus:ring-neutral-700 rounded-lg",children:G("h5",{className:"text-2xl cursor-pointer font-bold tracking-tight text-white capitalize hover:text-neutral-100",children:[w,z("span",{className:"absolute top-0 bottom-0 left-0 right-16"})]})}),G("div",{className:"z-10 flex gap-2",children:[G(Mt,{href:`/redevs/collections/${w}`,className:"inline-block text-neutral-200 hover:bg-neutral-900 focus:ring-4 focus:outline-none focus:ring-neutral-700 rounded-lg text-sm p-1.5",children:[z("span",{className:"sr-only",children:"Edit collection"}),G("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24",children:[z("path",{fill:"none",d:"M0 0h24v24H0z"}),z("path",{fill:"#e5e5e5",d:"M15.7279 9.57629L14.3137 8.16207L5 17.4758V18.89H6.41421L15.7279 9.57629ZM17.1421 8.16207L18.5563 6.74786L17.1421 5.33365L15.7279 6.74786L17.1421 8.16207ZM7.24264 20.89H3V16.6474L16.435 3.21233C16.8256 2.8218 17.4587 2.8218 17.8492 3.21233L20.6777 6.04075C21.0682 6.43128 21.0682 7.06444 20.6777 7.45497L7.24264 20.89Z"})]})]}),G("button",{className:"z-10 inline-block text-neutral-200 hover:bg-neutral-900 focus:ring-4 focus:outline-none focus:ring-neutral-700 rounded-lg text-sm p-1.5",type:"button",onClick:()=>{c(!0),b(w)},children:[z("span",{className:"sr-only",children:"Delete content"}),G("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24",children:[z("path",{fill:"none",d:"M0 0h24v24H0z"}),z("path",{fill:"#e5e5e5",d:"M17 6h5v2h-2v13a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V8H2V6h5V3a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v3zm1 2H6v12h12V8zm-9 3h2v6H9v-6zm4 0h2v6h-2v-6zM9 4v2h6V4H9z"})]})]})]})]},w))})]}),i&&G(ze,{title:"Delete Collection",close:()=>{c(!1),b("")},children:[G("div",{className:"space-y-6 p-6 text-left",children:[z("p",{className:"text-base leading-relaxed text-neutral-500",children:"Are you sure you want to delete this collection? This may break your website."}),z("p",{className:"text-base leading-relaxed text-neutral-500",children:"This action cannot be undone."})]}),G("div",{className:"flex items-center space-x-2 rounded-b border-t-2 border-neutral-800 p-6",children:[z("button",{type:"button",className:"flex rounded-lg bg-red-700 px-5 py-2.5 text-center text-sm font-medium text-white hover:bg-red-800 focus:outline-none",onClick:()=>{u(!0),f(m)},children:d?G(Zo,{children:[G("svg",{className:"mr-3 -ml-1 h-5 w-5 animate-spin text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[z("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),z("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Deleting"]}):"Delete"}),z("button",{type:"button",className:"rounded-lg border-2 border-neutral-800 px-5 py-2.5 text-sm font-medium focus:z-10 focus:outline-none focus:ring-4 bg-neutral-900 text-white hover:bg-neutral-800 focus:ring-neutral-700",onClick:()=>{c(!1),b("")},children:"Cancel"})]})]})]})}var Qo=(e,t,o)=>{let r={};Object.entries(e).forEach(([i,c])=>{isNaN(new Date(c).getMonth())||(r[i]=i===t?o:c)});let n=JSON.parse(JSON.stringify(e)),s=t.split("."),l=s.pop(),a=s.reduce((i,c)=>i[c],n);try{a[l]!==void 0&&(a[l]=o)}catch(i){console.log(`Key ${t} not found`)}return g(g({},n),r)};var Yt=()=>{let e=new Date().valueOf()-new Date().getTimezoneOffset()*6e3;return new Date(e)};var Yo=e=>{let t=new RegExp(`(\\!\\[[^\\]]*\\]\\()/${Pe.replace(/\//g,"\\/")}([^)]+)`,"g");return e.replace(t,`$1/${Ue}$2`)};import Xs from"gray-matter";import{useEffect as ea}from"react";var Xo=({collection:e,methods:t,slug:o,editor:r,session:n,setHasChanges:s,setShowDelete:l})=>{let{data:a}=Le({file:`${e}/${o}.md`,skip:o==="new"||!o});ea(()=>{var m,b,d;let i=(m=a==null?void 0:a.repository)==null?void 0:m.object;if((i==null?void 0:i.__typename)==="Blob"){let u=i.text,{data:p,content:h}=Xs(u),x=Yo(h),f=p.publishedAt?new Date(p.publishedAt):Yt(),v=y(g({},p),{publishedAt:f,content:x,slug:o});t.reset(v),r.commands.setContent(x),r.commands.focus("start"),l(o!=="new")}else if(o){let u=t.getValues();t.reset(y(g({},u),{author:{name:(b=n==null?void 0:n.user.name)!=null?b:"",picture:(d=n==null?void 0:n.user.image)!=null?d:""},coverImage:"",publishedAt:o==="new"?Yt():u.publishedAt}))}let c=t.watch(()=>s(!0));return()=>c.unsubscribe()},[a,t,o,r,n])};function er(e){throw new Error("Reached a code that should be unreachable. This can happen, when a TS type is incorrectly defined.")}import or from"dompurify";function ta(e){let t=new RegExp(`!\\[([^\\]]*?)\\]\\((/${Ue})([^\\)]+?)\\)`,"g");return e.replace(t,(r,n,s,l)=>`![${n}](/${Pe}${l})`)}var tr=ta;var rr=e=>{let t=Object.entries((a=>{var i=a,{content:n,publishedAt:s}=i,l=W(i,["content","publishedAt"]);return l})(e));e.publishedAt&&t.push(["publishedAt",e.publishedAt.toISOString()]);let o=`---
`;Object.entries(t).forEach(([n,s])=>{Array.isArray(s[1])?o+=`${s[0]}: ${JSON.stringify(s[1])}
`:s[1]instanceof Object?(o+=`${s[0]}:
`,Object.entries(s[1]).forEach(([l,a])=>{o+=`  ${l}: '${or.sanitize(a).replaceAll("'","''")}'
`})):o+=`${s[0]}: '${or.sanitize(s[1]).replaceAll("'","''")}'
`}),o+=`---

`;let r=tr(e.content);return o+=r,o};import oa from"gray-matter";import ra from"imurmurhash";import{useCallback as na}from"react";function sa({session:e,slug:t,setSlug:o,setShowDelete:r,setLoading:n,files:s,methods:l,collection:a,customFields:i,setCustomFields:c,setHasChanges:m,editor:b}){let[d]=ie(),{repoOwner:u,repoSlug:p,repoBranch:h,contentPath:x,monorepoPath:f}=L(),v=ce(),{data:w}=Le({file:"metadata.json"});return na(S=>A(this,null,function*(){var D,k,O,_,C;n(!0);try{let F=l.getValues(),V=b.storage.markdown.getMarkdown(),B=rr(y(g({},S),{content:V})),P=yield v(),Z=u||((D=e==null?void 0:e.user)==null?void 0:D.login)||"",j=F.slug,M=t!==j&&t!=="new"?t:void 0,$=ge({message:M?`chore: Updates ${j} formerly ${M}`:`chore: Updates/Creates ${j}`,owner:Z,oid:P!=null?P:"",name:p,branch:h});M&&$.removeFile(`${f?f+"/":""}${x}/${a}/${M}.md`),s.length>0&&s.forEach(({filename:q,blob:X,type:ue,content:Me})=>{if(X&&B.search(X)!==-1){let nt=window.btoa(Math.random().toString()).substring(10,6),Ot=q.toLowerCase().replace(/[^a-zA-Z0-9-_\.]/g,"-").replace(/(\.[^\.]*)?$/,`-${nt}$1`),ft=(()=>{switch(ue){case"image":return Pe;default:er(ue)}})();$.replaceFile(`${f?f+"/":""}public/${ft}${Ot}`,Me,!1),B=B.replace(X,`/${ft}${Ot}`)}});let{data:ae}=oa(B);$.replaceFile(`${f?f+"/":""}${x}/${a}/${j}.md`,B);let ke=!1;if(Object.entries(i).forEach(([q,X])=>{let ue=i[q],Me=S[q];if(st(X)&&st(ue)){if(!Array.isArray(Me)){ae[q]=[];return}Me.forEach(nt=>{X.values.some(ft=>ft.value===nt.value)||(ue.values.push({value:nt.value,label:nt.label}),i[q]=ue,c(g({},i)),ke=!0)})}}),ke){let q=JSON.stringify({title:a,type:"object",properties:g({},i)},null,2);$.replaceFile(`${f?f+"/":""}${x}/${a}/schema.json`,q+`
`)}if(((O=(k=w==null?void 0:w.repository)==null?void 0:k.object)==null?void 0:O.__typename)==="Blob"){let q=JSON.parse((_=w.repository.object.text)!=null?_:"{}");q.generated=new Date().toISOString(),q.commit=Ce(w.repository.object.commitUrl);let X=((C=q.metadata)!=null?C:[]).filter(Me=>!(Me.collection===a&&(Me.slug===M||Me.slug===j))),ue=ra(B);X.push(y(g({},ae),{title:ae.title,publishedAt:ae.publishedAt,status:ae.status,slug:j,collection:a,__outstatic:{hash:`${ue.result()}`,commit:q.commit,path:`${x}/${a}/${j}.md`}})),$.replaceFile(`${f?f+"/":""}${x}/metadata.json`,Ae(y(g({},q),{metadata:X})))}let Se=$.createInput();yield d({variables:{input:Se}}),n(!1),m(!1),o(j),r(!0)}catch(F){n(!1),console.log({error:F})}}),[u,e,t,o,r,n,s,d,v,l,f,x,a,i,c,p,h,w,m,b])}var nr=sa;import{InputRule as Ua}from"@tiptap/core";import ja from"@tiptap/extension-code-block-lowlight";import qa from"@tiptap/extension-highlight";import Wa from"@tiptap/extension-horizontal-rule";import Ga from"@tiptap/extension-image";import Ka from"@tiptap/extension-link";import Ja from"@tiptap/extension-underline";import{ReactNodeViewRenderer as Za}from"@tiptap/react";import Qa from"@tiptap/starter-kit";import Ya from"lowlight";import{Markdown as Xa}from"tiptap-markdown";import{NodeViewContent as aa,NodeViewWrapper as ia}from"@tiptap/react";import{jsx as tt,jsxs as sr}from"react/jsx-runtime";var la=({node:{attrs:{language:e}},updateAttributes:t,extension:o})=>sr(ia,{className:"relative",children:[tt("div",{className:"absolute top-0 right-6 rounded-b-md border-2 border-t-0 border-neutral-800 px-3 py-1",children:sr("select",{contentEditable:!1,defaultValue:e,className:"select-none bg-gradient-to-tr from-primary-300 to-primary-400 bg-clip-text font-medium text-white outline-none text-sm",onChange:r=>t({language:r.target.value}),children:[tt("option",{value:"null",children:"auto"}),tt("option",{disabled:!0,children:"\u2014"}),o.options.lowlight.listLanguages().map((r,n)=>tt("option",{value:r,children:r},n))]})}),tt("pre",{className:"text-white bg-black border-2 border-neutral-800 rounded-md p-4 pt-12",children:tt(aa,{as:"code"})})]}),ar=la;import{Extension as Oa}from"@tiptap/core";import{ReactRenderer as La}from"@tiptap/react";import Fa from"@tiptap/suggestion";import{useState as Ia}from"react";import Ra from"tippy.js";import{useCompletion as ca}from"ai/react";import{useCallback as ma,useEffect as ir,useLayoutEffect as ua,useRef as da,useState as pa}from"react";import{toast as fa}from"sonner";var ut=(e,{chars:t,offset:o=0})=>e.state.doc.textBetween(Math.max(0,e.state.selection.from-t),e.state.selection.from-o,`
`);import{jsx as Re,jsxs as Xt}from"react/jsx-runtime";var lr=({items:e,command:t,setImageMenu:o,editor:r,range:n})=>{let[s,l]=pa(0),{hasOpenAIKey:a}=L(),{complete:i,isLoading:c}=ca({id:"outstatic",api:"/api/redevs/generate",onResponse:()=>{r.chain().focus().deleteRange(n).run()},onFinish:(d,u)=>{r.commands.setTextSelection({from:n.from,to:n.from+u.length})},onError:d=>{fa.error(d.message)}}),m=ma(d=>{let u=e[d];if(u)if(u.title==="Continue writing"){if(c)return;i(ut(r,{chars:5e3,offset:1}))}else u.title==="Image"?o(!0):t(u)},[i,c,t,r,e]);ir(()=>{let d=["ArrowUp","ArrowDown","Enter"],u=p=>{if(d.includes(p.key))return p.preventDefault(),p.key==="ArrowUp"?(l((s+e.length-1)%e.length),!0):p.key==="ArrowDown"?(l((s+1)%e.length),!0):p.key==="Enter"?(m(s),!0):!1};return document.addEventListener("keydown",u),()=>{document.removeEventListener("keydown",u)}},[e,m,s]),ir(()=>{l(0)},[e]);let b=da(null);return ua(()=>{let d=b==null?void 0:b.current,u=d==null?void 0:d.children[s];u&&d&&Pt(d,u)},[s]),e.length>0?Re("div",{id:"outstatic",children:Re("div",{id:"slash-command",ref:b,className:"z-50 h-auto max-h-[330px] w-72 overflow-y-auto rounded-md border-2 border-stone-200 invert bg-white px-1 py-2 transition-all",children:e.map((d,u)=>d.title==="Continue writing"&&!a?null:Xt("button",{className:`flex w-full items-center space-x-2 rounded-md px-2 py-1 text-left text-sm text-stone-900 hover:bg-stone-100 ${u===s?"bg-stone-100 text-stone-900":""}`,onClick:()=>m(u),children:[Re("div",{className:"flex h-10 w-10 items-center justify-center rounded-md border border-stone-200 bg-white",children:d.title==="Continue writing"&&c?Re("div",{children:Xt("svg",{className:"h-6 animate-spin text-black",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",width:"18",children:[Re("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),Re("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}):d.icon}),Xt("div",{children:[Re("p",{className:"font-medium",children:d.title}),Re("p",{className:"text-xs text-stone-500",children:d.description})]})]},u))})}):null};import{Link as ga,Upload as ha}from"lucide-react";import{useEffect as eo,useLayoutEffect as ba,useRef as xa,useState as Dt}from"react";import{jsx as he,jsxs as At}from"react/jsx-runtime";var va=e=>{try{return!!new URL(e)}catch(t){return!1}},ot=[{title:"Image Upload",description:"Upload or embed with a link.",searchTerms:["upload","picture","media"],icon:he(ha,{size:18})},{title:"Image from URL",description:"Upload or embed with a link.",searchTerms:["photo","picture","media"],icon:he(ga,{size:18})}],ya=({editor:e,range:t,setImageMenu:o})=>{let[r,n]=Dt(!1),[s,l]=Dt(""),[a,i]=Dt({imageUrl:"",uploadImage:""}),[c,m]=Dt(0),b=()=>A(void 0,null,function*(){e.chain().focus().deleteRange(t).run();let h=document.createElement("input");h.type="file",h.accept="image/*",h.onchange=()=>A(void 0,null,function*(){var x;if((x=h.files)!=null&&x.length){let f=h.files[0],v=He(f);v&&e.chain().focus().setImage({src:v,alt:""}).run()}}),h.click()}),d=h=>{l(h.target.value)},u=()=>{if(!va(s))return i(h=>y(g({},h),{imageUrl:"Invalid URL"})),null;s&&(e.chain().focus().deleteRange(t).run(),e.chain().focus().setImage({src:s,alt:"",title:""}).insertContent("").run(),e.chain().blur().run()),n(!1)};eo(()=>{let h=["ArrowUp","ArrowDown","Enter","Escape"],x=f=>{if(h.includes(f.key))return f.preventDefault(),f.key==="ArrowUp"?(m((c+ot.length-1)%ot.length),!0):f.key==="ArrowDown"?(m((c+1)%ot.length),!0):f.key==="Enter"?(ot[c].title==="Image Upload"?b():r?u():n(!0),!0):f.key==="Escape"?(r?n(!1):(o(!1),e.chain().focus().run()),!0):!1};return document.addEventListener("keydown",x),()=>{document.removeEventListener("keydown",x)}},[c,r]),eo(()=>{e.chain().blur().run()},[]),eo(()=>{m(0)},[ot]);let p=xa(null);return ba(()=>{let h=p==null?void 0:p.current,x=h==null?void 0:h.children[c];x&&h&&Pt(h,x)},[c]),he("div",{id:"outstatic",className:"invert",children:r?At("div",{className:"flex w-[500px] border-2 border-black outline-none",children:[At("div",{className:"relative w-[500px] border-2 border-neutral-800",children:[he("input",{type:"text",className:`w-full h-full py-2 px-3 outline-none ${a.imageUrl?"bg-red-50":"bg-black text-white"}`,placeholder:"Insert link here",onChange:d,value:s,onFocus:()=>i(y(g({},a),{imageUrl:""})),autoFocus:!0}),a.imageUrl&&he("span",{className:"absolute text-red-500 top-10 left-0",children:a.imageUrl})]}),he(U,{onClick:u,editor:e,name:"back",children:"Done"})]}):he("div",{id:"slash-command",ref:p,className:"invert z-50 h-auto max-h-[330px] w-72 overflow-y-auto rounded-md border border-stone-200 bg-white px-1 py-2 transition-all",children:ot.map((h,x)=>At("button",{className:`flex w-full items-center space-x-2 rounded-md px-2 py-1 text-left text-sm text-stone-900 hover:bg-stone-100 ${x===c?"bg-stone-100 text-stone-900":""}`,onClick:()=>h.title==="Image Upload"?b():n(!0),onKeyDown:f=>{f.key==="Enter"&&(h.title==="Image Upload"?b():n(!0))},children:[he("div",{className:"flex h-10 w-10 items-center justify-center rounded-md border-2 border-stone-200 bg-white",children:h.icon}),At("div",{children:[he("p",{className:"font-medium",children:h.title}),he("p",{className:"text-xs text-stone-500",children:h.description})]})]},x))})})},cr=ya;import{Code as wa,Edit3 as Ca,Heading1 as Na,Heading2 as ka,Heading3 as Sa,Image as Ma,List as Pa,ListOrdered as Da,Text as Aa,TextQuote as Ea}from"lucide-react";import{jsx as be}from"react/jsx-runtime";var mr=[{title:"Continue writing",description:"Use AI to expand your thoughts.",icon:be(Ca,{size:18})},{title:"Text",description:"Just start typing with plain text.",searchTerms:["p","paragraph"],icon:be(Aa,{size:18}),command:({editor:e,range:t})=>{e.chain().focus().deleteRange(t).toggleNode("paragraph","paragraph").run()}},{title:"Heading 1",description:"Big section heading.",searchTerms:["title","big","large","h1"],icon:be(Na,{size:18}),command:({editor:e,range:t})=>{e.chain().focus().deleteRange(t).setNode("heading",{level:1}).run()}},{title:"Heading 2",description:"Medium section heading.",searchTerms:["subtitle","medium","h2"],icon:be(ka,{size:18}),command:({editor:e,range:t})=>{e.chain().focus().deleteRange(t).setNode("heading",{level:2}).run()}},{title:"Heading 3",description:"Small section heading.",searchTerms:["subtitle","small","h3"],icon:be(Sa,{size:18}),command:({editor:e,range:t})=>{e.chain().focus().deleteRange(t).setNode("heading",{level:3}).run()}},{title:"Bullet List",description:"Create a simple bullet list.",searchTerms:["unordered","point"],icon:be(Pa,{size:18}),command:({editor:e,range:t})=>{e.chain().focus().deleteRange(t).toggleBulletList().run()}},{title:"Numbered List",description:"Create a list with numbering.",searchTerms:["ordered"],icon:be(Da,{size:18}),command:({editor:e,range:t})=>{e.chain().focus().deleteRange(t).toggleOrderedList().run()}},{title:"Quote",description:"Capture a quote.",searchTerms:["blockquote"],icon:be(Ea,{size:18}),command:({editor:e,range:t})=>e.chain().focus().deleteRange(t).toggleNode("paragraph","paragraph").toggleBlockquote().run()},{title:"Code",description:"Capture a code snippet.",searchTerms:["codeblock"],icon:be(wa,{size:18}),command:({editor:e,range:t})=>e.chain().focus().deleteRange(t).toggleCodeBlock().run()},{title:"Image",description:"Upload or embed with a link.",searchTerms:["photo","picture","media"],icon:be(Ma,{size:18})}],Ta=(e,t)=>e.filter(o=>{let r=o.title.toLowerCase().includes(t),n=o.description.toLowerCase().includes(t),s=o.searchTerms&&o.searchTerms.some(l=>l.includes(t));return!!(r||n||s)}),ur=e=>{let{query:t}=e;if(typeof t!="string"||t.length===0)return mr;let o=t.toLowerCase();return Ta(mr,o)};import{jsx as dr}from"react/jsx-runtime";var $a=Oa.create({name:"slash-command",addOptions(){return{suggestion:{char:"/",command:({editor:e,range:t,props:o})=>{o.command({editor:e,range:t})}}}},addProseMirrorPlugins(){return[Fa(g({editor:this.editor},this.options.suggestion))]}}),Pt=(e,t)=>{let o=e.offsetHeight,r=t?t.offsetHeight:0,n=t.offsetTop,s=n+r;n<e.scrollTop?e.scrollTop-=e.scrollTop-n+5:s>o+e.scrollTop&&(e.scrollTop+=s-o-e.scrollTop+5)},za=({items:e,command:t,editor:o,range:r})=>{let[n,s]=Ia(!1);return e.length>0?n?dr(cr,{editor:o,setImageMenu:s,range:r}):dr(lr,{items:e,command:t,setImageMenu:s,editor:o,range:r}):null},Ba=()=>{let e=null,t=null;return{onStart:o=>{e=new La(za,{props:o,editor:o.editor}),t=Ra("body",{getReferenceClientRect:o.clientRect,appendTo:()=>document.body,content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start"})},onUpdate:o=>{e==null||e.updateProps(o),t&&t[0].setProps({getReferenceClientRect:o.clientRect})},onKeyDown:o=>{var r;return o.event.key==="Escape"?(t==null||t[0].hide(),!0):(r=e==null?void 0:e.ref)==null?void 0:r.onKeyDown(o)},onExit:()=>{var o;(o=t==null?void 0:t[0])==null||o.destroy(),e==null||e.destroy()}}},Ha=$a.configure({suggestion:{items:ur,render:Ba}}),pr=Ha;import{Extension as _a}from"@tiptap/core";var Va=e=>({tr:t,state:o})=>{let{selection:r}=o,{$anchor:n}=r,s=n.node(n.depth);if(!s||s.isText)return!1;let l=s.attrs.class||"",a=l.split(" "),i=a.includes(e),c;i?c=a.filter(b=>b!==e).join(" "):c=`${l} ${e}`.trim();let m=y(g({},s.attrs),{class:c});return t.setNodeMarkup(n.before(n.depth),null,m),!0},fr=_a.create({name:"toggleClass",addGlobalAttributes(){return[{types:["heading","paragraph"],attributes:{class:{default:"",renderHTML:e=>({class:`${e.class}`})}}}]},addCommands(){return{toggleClass:e=>({commands:t})=>t.command(Va(e))}}});var gr=[Qa.configure({bulletList:{HTMLAttributes:{class:"list-disc list-outside leading-3 -mt-2"}},orderedList:{HTMLAttributes:{class:"list-decimal list-outside leading-3 -mt-2"}},listItem:{HTMLAttributes:{class:"leading-normal -mb-2"}},blockquote:{HTMLAttributes:{class:"border-l-4 border-stone-700"}},codeBlock:!1,code:{HTMLAttributes:{class:"rounded-md bg-stone-200 px-1.5 py-1 font-mono font-medium text-stone-900",spellcheck:"false"}},horizontalRule:!1,dropcursor:{color:"#DBEAFE",width:4},gapcursor:!1}),fr,Wa.extend({addInputRules(){return[new Ua({find:/^(?:---|-|___\s|\*\*\*\s)$/,handler:({state:e,range:t})=>{let o={},{tr:r}=e,n=t.from,s=t.to;r.insert(n-1,this.type.create(o)).delete(r.mapping.map(n),r.mapping.map(s))}})]}}).configure({HTMLAttributes:{class:"mt-4 mb-6 border-t border-stone-300"}}),pr,Ja,qa.configure({multicolor:!0}),Xa.configure({html:!1,linkify:!1,transformPastedText:!0}),Ga.extend({renderHTML({HTMLAttributes:e}){return["img",y(g({},e),{onError:`this.classList.add("image-error");this.alt="Couldn't load image.";`})]}}).configure({inline:!0}),Ka.configure({openOnClick:!1}),ja.extend({addNodeView(){return Za(ar)}}).configure({lowlight:Ya})];var hr={attributes:{class:"prose-lg prose-stone prose-headings:font-display font-default focus:outline-none max-w-full"},handleDOMEvents:{keydown:(e,t)=>{if(["ArrowUp","ArrowDown","Enter"].includes(t.key)&&document.querySelector("#slash-command"))return!0}},handlePaste:(e,t)=>{var o;if(t.clipboardData&&t.clipboardData.files&&t.clipboardData.files[0]){t.preventDefault();let r=Array.from(((o=t.clipboardData)==null?void 0:o.items)||[]);for(let n of r)if(n.type.indexOf("image")===0){let{schema:s}=e.state,l=t.clipboardData.files[0],a=He(l),i=s.nodes.image.create({src:a,alt:""}),c=e.state.tr.replaceSelectionWith(i);return e.dispatch(c),!0}}return!1},handleDrop:(e,t,o,r)=>{if(!r&&t.dataTransfer&&t.dataTransfer.files&&t.dataTransfer.files[0]){if(t.preventDefault(),t.dataTransfer.files[0]!==void 0){let n=t.dataTransfer.files[0],s=He(n),{schema:l}=e.state,a=l.nodes.image.create({src:s,alt:""}),i=e.state.tr.replaceSelectionWith(a);return e.dispatch(i),!0}return!1}}};import ei from"@tiptap/extension-placeholder";import{useEditor as ti}from"@tiptap/react";import{useCompletion as oi}from"ai/react";import{useEffect as Et,useRef as br}from"react";import{toast as to}from"sonner";import{useDebouncedCallback as ri}from"use-debounce";var ni=t=>{var e=W(t,[]);let{hasOpenAIKey:o}=L(),{setValue:r,trigger:n}=e,s=br(null),l=ri(p=>A(void 0,[p],function*({editor:u}){let h=u.getHTML();r("content",h&&!u.isEmpty?h:""),A(void 0,null,function*(){return yield n("content")})}),750),a=ti({extensions:[...gr,ei.configure({placeholder:({node:u})=>u.type.name==="heading"?`Heading ${u.attrs.level}`:`Press '/' for commands${o?", or '++' for AI autocomplete...":""}`,includeChildren:!0})],editorProps:hr,onUpdate({editor:u}){let p=u.state.selection,h=ut(u,{chars:2});if(o&&h==="++"&&!m){u.commands.deleteRange({from:p.from-2,to:p.from});let x=ut(u,{chars:5e3});x===""?to.error("Write some content so the AI can continue."):i(x)}else l({editor:u})}});Et(()=>{s.current=a},[a]);let{complete:i,completion:c,isLoading:m,stop:b}=oi({id:"outstatic",api:"/apitam/generate",onFinish:(u,p)=>{s.current&&s.current.commands.setTextSelection({from:s.current.state.selection.from-p.length,to:s.current.state.selection.from})},onError:u=>{to.error(u.message)}}),d=br("");return Et(()=>{a==null||a.commands.toggleClass("completing")},[m]),Et(()=>{let u=c.slice(d.current.length);d.current=c;try{a==null||a.commands.insertContent(u)}catch(p){console.log(`error adding content: ${u}`)}},[m,a,c]),Et(()=>{let u=h=>{(h.key==="Escape"||h.metaKey&&h.key==="z")&&(b(),h.key==="Escape"&&(a==null||a.commands.deleteRange({from:a.state.selection.from-c.length,to:a.state.selection.from}),to.message("AI writing cancelled.")))},p=h=>{h.preventDefault(),h.stopPropagation(),b(),window.confirm("AI writing paused. Continue?")&&i((a==null?void 0:a.getText())||"")};return m?(document.addEventListener("keydown",u),window.addEventListener("mousedown",p)):(document.removeEventListener("keydown",u),window.removeEventListener("mousedown",p)),()=>{document.removeEventListener("keydown",u),window.removeEventListener("mousedown",p)}},[b,m,a,i,c.length]),{editor:a}},xr=ni;import*as J from"yup";var vr=/^([a-z0-9]+-)*[a-z0-9]+$/;var yr={title:J.string().required("Title is required."),publishedAt:J.date().required("Date is required."),content:J.string().required("Content is required."),status:J.string().equals(["published","draft"]).required("Status is missing."),author:J.object().shape({name:J.string(),picture:J.string()}),slug:J.string().matches(/^(?!new$)/,'The word "new" is not a valid slug.').matches(vr,"Slug must contain only lowercase letters, numbers, and hyphens, and cannot start or end with a hyphen.").max(200,"Slugs can be a maximum of 200 characters.").required(),description:J.string(),coverImage:J.string()},wr=J.object().shape(yr),Cr=e=>{let t={};for(let[r,n]of Object.entries(e.properties))t[r]=J[n.dataType](),n.required&&(t[r]=t[r].required(`${n.title} is a required field.`)),n.dataType==="number"&&(t[r]=t[r].typeError(`${n.title} is a required field.`)),n.dataType==="array"&&n.required&&(t[r]=t[r].min(1,`${n.title} is a required field.`));return J.object().shape(g(g({},yr),t))};import{yupResolver as si}from"@hookform/resolvers/yup";import ai from"next/head";import{usePathname as ii}from"next/navigation";import{singular as li}from"pluralize";import{useEffect as Nr,useState as dt}from"react";import{FormProvider as ci,useForm as mi}from"react-hook-form";import{Fragment as ui,jsx as xe,jsxs as oo}from"react/jsx-runtime";function ro({collection:e}){let t=ii(),[o,r]=dt(t.split("/").pop()||`/${e}/new`),{session:n}=pe(),[s,l]=dt(!1),{hasChanges:a,setHasChanges:i}=L(),[c,m]=dt(!1),[b,d]=dt(wr),u=mi({resolver:si(b)}),{editor:p}=xr(g({},u)),[h,x]=dt({}),f=Ke(S=>S.files),v=(S,D)=>{let k=u.getValues(),O=Qo(k,S,D);u.reset(O)},{data:w}=Le({file:`${e}/schema.json`}),R=nr({session:n,slug:o,setSlug:r,setShowDelete:m,setLoading:l,files:f,methods:u,collection:e,customFields:h,setCustomFields:x,setHasChanges:i,editor:p});return Nr(()=>{window.history.replaceState({},"",`/redevs/${e}/${o}`)},[o]),Xo({collection:e,methods:u,slug:o,editor:p,session:n,setHasChanges:i,setShowDelete:m}),Nr(()=>{var D;let S=(D=w==null?void 0:w.repository)==null?void 0:D.object;if((S==null?void 0:S.__typename)==="Blob"){let k=JSON.parse((S==null?void 0:S.text)||"{}"),O=Cr(k);d(O),x(k.properties)}},[w]),oo(ui,{children:[oo(ai,{children:[xe("link",{rel:"preconnect",href:"https://fonts.googleapis.com"}),xe("link",{rel:"preconnect",href:"https://fonts.gstatic.com",crossOrigin:""}),xe("link",{href:"https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=PT+Serif:ital,wght@0,400;0,700;1,400;1,700&display=swap",rel:"stylesheet"})]}),xe(De.Provider,{value:{editor:p,document:u.getValues(),editDocument:v,hasChanges:a,collection:e},children:xe(ci,y(g({},u),{children:xe(te,{title:u.getValues("title"),settings:xe(Wt,{loading:s,saveFunc:u.handleSubmit(R),showDelete:c,customFields:h}),children:oo("form",{className:"m-auto max-w-[700px] space-y-4",children:[xe(St,{id:"title",className:"w-full resize-none outline-none bg-black text-5xl scrollbar-hide min-h-[55px] overflow-hidden",placeholder:`Your ${li(e)} title`}),xe("div",{className:"min-h-full prose prose-xl",children:xe(Vt,{editor:p,id:"content"})})]})})}))})]})}import di from"gray-matter";import kr from"next/link";import{useRouter as pi}from"next/navigation";import{singular as no}from"pluralize";import{jsx as ve,jsxs as _e}from"react/jsx-runtime";var fi={year:"numeric",month:"long",day:"numeric"};function so({collection:e}){var u,p,h,x,f;let t=pi(),{repoOwner:o,repoSlug:r,repoBranch:n,contentPath:s,monorepoPath:l,session:a}=L(),{data:i,error:c,loading:m}=vo({variables:{owner:o||((u=a==null?void 0:a.user)==null?void 0:u.login)||"",name:r||"",contentPath:`${n}:${l?l+"/":""}${s}/${e}`||""},fetchPolicy:"network-only",onError:({graphQLErrors:v})=>{var w;return v&&((w=v==null?void 0:v[0])==null?void 0:w.type)==="NOT_FOUND"&&t.push("/api/redevs/signout"),null}}),b=[],d=((h=(p=i==null?void 0:i.repository)==null?void 0:p.object)==null?void 0:h.__typename)==="Tree"&&((f=(x=i==null?void 0:i.repository)==null?void 0:x.object)==null?void 0:f.entries);return d&&(d.forEach(v=>{var w,R,S;if(v.name.slice(-3)===".md"){let{data:D}=di(((w=v==null?void 0:v.object)==null?void 0:w.__typename)==="Blob"&&((R=v==null?void 0:v.object)!=null&&R.text)?(S=v==null?void 0:v.object)==null?void 0:S.text:""),k=g({},D);delete k.coverImage,b.push(y(g({},k),{author:k.author.name||"",publishedAt:new Date(k.publishedAt).toLocaleDateString("en-US",fi),slug:v.name.replace(".md","")}))}}),b.sort((v,w)=>Number(w.publishedAt)-Number(v.publishedAt))),_e(te,{error:c,title:e[0].toUpperCase()+e.slice(1),children:[_e("div",{className:"mb-8 flex h-12 items-center",children:[ve("h1",{className:"mr-12 text-2xl capitalize",children:e}),ve(kr,{href:`/redevs/${e}/new`,children:_e("div",{className:"cursor-pointer rounded-lg px-5 py-2.5 text-sm font-medium focus:outline-none focus:ring-4 bg-neutral-800 hover:bg-neutral-800/90 text-white hover:border-2 hover:border-neutral-800 focus:ring-neutral-700 capitalize",children:["New ",no(e)]})})]}),b.length>0&&ve("div",{className:"relative shadow-md sm:rounded-lg",children:ve(Kt,{documents:b,collection:e})}),b.length===0&&!m&&ve("div",{className:"max-w-2xl",children:ve("div",{className:"relative",children:_e("div",{className:"mb-20 max-w-2xl p-8 px-4 md:p-8 text-white bg-black rounded-lg border-2 border-neutral-800 shadow-md prose prose-base",children:[ve("p",{children:"This collection has no documents yet."}),_e("p",{children:["Create your first"," ",ve("span",{className:"capitalize",children:no(e)})," by clicking the button below."]}),ve(kr,{href:`/redevs/${e}/new`,children:_e("div",{className:"inline-block cursor-pointer rounded-lg px-5 py-2.5 text-sm font-medium focus:outline-none focus:ring-4 bg-neutral-800 hover:bg-neutral-800/90 text-white hover:scale-105 focus:ring-neutral-700 capitalize",children:["New ",no(e)]})}),_e("p",{children:["To learn more about how documents work"," ",ve("a",{href:"https://outstatic.com/docs/introduction#whats-a-document",target:"_blank",rel:"noreferrer",className:"text-neutral-300",children:"click here"}),"."]})]})})})]})}import{Fragment as ao,jsx as Ve,jsxs as io}from"react/jsx-runtime";var gi={something:"Something went wrong. Please try again.","repository-not-found":io(ao,{children:["We couldn't access your repository. ",Ve("br",{}),"Please, check out our"," ",Ve("a",{className:"underline",target:"_blank",href:"https://outstatic.com/docs/faqs#troubleshooting-login-and-repository-access-issues",children:"troubleshooting guide"}),"."]}),"not-collaborator":io(ao,{children:["You're not a collaborator of this repository. ",Ve("br",{}),"Please, check out our"," ",Ve("a",{className:"underline",target:"_blank",href:"https://outstatic.com/docs/faqs#troubleshooting-login-and-repository-access-issues",children:"troubleshooting guide"}),"."]}),redirect_uri_mismatch:io(ao,{children:["The redirect_uri MUST match the registered callback URL for this application. ",Ve("br",{}),Ve("br",{}),"For more information:"," ",Ve("a",{className:"underline",target:"_blank",href:"https://docs.github.com/apps/managing-oauth-apps/troubleshooting-authorization-request-errors/#redirect-uri-mismatch",children:"GitHub Apps troubleshooting"}),"."]})},lo=gi;import hi from"clsx";import{useSearchParams as bi}from"next/navigation";import{useState as xi}from"react";import vi from"next/image";import{Fragment as yi,jsx as ye,jsxs as co}from"react/jsx-runtime";function mo(){let t=bi().get("error"),[o,r]=xi(!1);return ye(yi,{children:ye("div",{className:"bg-black",id:"outstatic",children:ye("main",{className:"relative flex h-screen items-center bg-black justify-center z-10 p-4",children:co("div",{className:"relative flex flex-col items-center justify-center",children:[t&&lo[t]?ye("div",{className:"absolute -top-4 -translate-y-full",children:ye(Oe,{type:"error",children:lo[t]})}):null,ye("h1",{className:"mb-8 text-center text-xl font-semibold text-white border-2 px-6 p-2 rounded-full border-neutral-800",children:ye(vi,{src:"https://redevs.org/redevs.svg",alt:"",width:150,height:100,className:"invert"})}),co("div",{className:"text-center mb-20 flex max-w-2xl flex-col items-center p-8 px-4 md:p-8 text-white bg-black rounded-lg border-2 border-neutral-800 shadow-md",children:[ye("p",{className:"mb-5",children:"Sign in with GitHub to access your\xA0dashboard."}),co("a",{href:"/api/redevs/login",onClick:()=>r(!0),className:hi("mr-2 mb-2 inline-flex items-center rounded-lg bg-neutral-800 px-5 py-2.5 text-center text-sm font-medium text-white hover:bg-neutral-800/90 focus:outline-none focus:ring-4 focus:ring-[#24292F]/50",o&&"animate-pulse"),children:[ye("svg",{className:"mr-2 -ml-1 h-4 w-4","aria-hidden":"true",focusable:"false","data-prefix":"fab","data-icon":"github",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 496 512",children:ye("path",{fill:"currentColor",d:"M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3 .3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5 .3-6.2 2.3zm44.2-1.7c-2.9 .7-4.9 2.6-4.6 4.9 .3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3 .7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3 .3 2.9 2.3 3.9 1.6 1 3.6 .7 4.3-.7 .7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3 .7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3 .7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"})}),"Sign in with GitHub"]})]})]})})})})}import{encode as wi}from"js-base64";var Sr=({owner:e,oid:t,remove:o=!1,repoSlug:r,repoBranch:n,contentPath:s,monorepoPath:l,collection:a})=>{let i={},c=[],m=[];o?(m.push({path:`${l?l+"/":""}${s}/${a}`}),i=y(g({},i),{deletions:m})):(c.push({path:`${l?l+"/":""}${s}/${a}/.gitkeep`,contents:wi("")}),i={additions:c});let b=o?`feat(content): remove ${a}`:`feat(content): create ${a}`;return{input:{branch:{repositoryNameWithOwner:`${e}/${r}`,branchName:n},message:{headline:b},fileChanges:i,expectedHeadOid:t}}};import{yupResolver as Ci}from"@hookform/resolvers/yup";import Ni from"next/link";import{useRouter as ki}from"next/navigation";import{useEffect as Si,useState as uo}from"react";import{FormProvider as Mi,useForm as Pi}from"react-hook-form";import{slugify as Di}from"transliteration";import*as Tt from"yup";import{Fragment as Ai,jsx as me,jsxs as rt}from"react/jsx-runtime";function po(){let{pages:e,contentPath:t,monorepoPath:o,session:r,repoSlug:n,repoBranch:s,repoOwner:l,addPage:a,hasChanges:i,setHasChanges:c}=L(),m=ki(),[b]=ie(),d=ce(),[u,p]=uo(""),h=new RegExp(`^(?!${e.join("$|")}$)`,"i"),x=Tt.object().shape({name:Tt.string().matches(h,`${u} is already taken.`).required("Collection name is required.")}),[f,v]=uo(!1),[w,R]=uo(!1),S=Pi({resolver:Ci(x)}),D=O=>A(this,[O],function*({name:k}){var _;v(!0),c(!1);try{let C=yield d(),F=l||((_=r==null?void 0:r.user)==null?void 0:_.login)||"",V=Di(k,{allowedChars:"a-zA-Z0-9"}),B=Sr({owner:F,oid:C,repoSlug:n,repoBranch:s,contentPath:t,monorepoPath:o,collection:V});(yield b({variables:B}))&&(a(V),v(!1),m.push(`/redevs/${V}`))}catch(C){v(!1),c(!1),R(!0),console.log({error:C})}});return Si(()=>{let k=S.watch(()=>c(!0));return()=>k.unsubscribe()},[S]),me(Mi,y(g({},S),{children:rt(te,{title:"New Collection",children:[me("div",{className:"mb-8 flex h-12 items-center",children:me("h1",{className:"mr-12 text-2xl",children:"Create a Collection"})}),w?rt(Oe,{type:"error",children:[me("span",{className:"text-white font-medium",children:"Oops!"})," We couldn't create your collection. Please, make sure your settings are correct by"," ",me(Ni,{href:"/redevs/settings",children:me("span",{className:"underline text-white",children:"clicking here"})})," ","."]}):null,rt("form",{className:"max-w-5xl w-full flex-col mb-4 items-start",onSubmit:S.handleSubmit(D),children:[me("label",{className:"text-neutral-200",children:"Collection Name"}),me(ne,{id:"name",inputSize:"medium",className:"w-full max-w-sm md:w-80 text-black border-neutral-800 border-2",placeholder:"Ex: Posts",type:"text",helperText:"We suggest naming the collection in plural form, ex: Docs",registerOptions:{onChange:k=>{p(k.target.value)},onBlur:k=>{S.setValue("name",k.target.value)}}}),me("button",{type:"submit",disabled:f||!i,className:"flex rounded-lg bg-neutral-800 hover:bg-neutral-800/90 text-white hover:scale-105 focus:ring-neutral-700  disabled:cursor-not-allowed disabled:bg-neutral-600 ml-2 mt-7 mb-5 px-5 py-2",children:f?rt(Ai,{children:[rt("svg",{className:"mr-3 -ml-1 h-5 w-5 animate-spin text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[me("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),me("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving"]}):"Save"})]}),u&&rt(Oe,{type:"info",children:["The collection will appear as"," ",me("span",{className:"font-semibold capitalize",children:u})," ","on the sidebar."]})]})}))}var Mr=(e,t)=>{let o=[],r=e.length,n=0;for(;n<r;)o.push(e.slice(n,n+=t));return o};import Ei from"gray-matter";import Ti from"imurmurhash";import{useEffect as Pr,useMemo as Oi,useState as Dr}from"react";import{jsx as Fi,jsxs as Ii}from"react/jsx-runtime";var Li=e=>/\.md(x|oc)?$/.test(e),Ar=r=>{var n=r,{rebuild:e,onComplete:t}=n,o=W(n,["rebuild","onComplete"]);var R;let[s,l]=Dr(0),[a,i]=Dr(0),c=ht(),m=ce(),[b]=ie(),{repoOwner:d,repoSlug:u,repoBranch:p,contentPath:h,monorepoPath:x}=L(),f=[x,h].filter(Boolean).join("/"),{data:v}=yo({variables:{owner:d,name:u,expression:`${p}:${f}`},skip:!e}),w=Oi(()=>{var O,_,C,F,V,B;let S=JSON.parse(JSON.stringify((_=(O=v==null?void 0:v.repository)==null?void 0:O.object)!=null?_:{})),D=[],k="entries"in S?(C=S.entries)!=null?C:[]:[];for(;k.length>0;){let P=k.pop();((F=P==null?void 0:P.object)==null?void 0:F.__typename)==="Tree"?k.push(...(V=P.object.entries)!=null?V:[]):((B=P==null?void 0:P.object)==null?void 0:B.__typename)==="Blob"&&Li(P.path)&&D.push({path:P.path,oid:`${P.object.oid}`,commit:Ce(`${P.object.commitUrl}`)})}return D},[v]);return Pr(()=>{let S=k=>A(void 0,null,function*(){var _,C,F,V,B;let O=yield c.query({query:bo,variables:{owner:d,name:u,filePath:`${p}:${k.path}`}});if(((C=(_=O.data.repository)==null?void 0:_.object)==null?void 0:C.__typename)==="Blob"){let P=Ei((F=O.data.repository.object.text)!=null?F:""),Z=Ti((V=O.data.repository.object.text)!=null?V:"");return y(g({},P.data),{slug:(B=P.data.slug)!=null?B:k.path.replace(/^.+\/(.+)\.(md|mdoc|mdx)?/,"$1"),__outstatic:{commit:k.commit,hash:`${Z.result()}`,path:x?k.path.replace(x,""):k.path}})}});(()=>A(void 0,null,function*(){var V,B;l(Math.max(w.length,1));let O=Mr(w,5),_=[],C=m();for(;O.length>0;){let P=O.pop();if(!P)continue;yield Promise.allSettled(P.map(j=>A(void 0,null,function*(){let M=yield S(j);_.push(y(g({},M),{collection:j.path.replace(f,"").replace(/^\/+/,"").replace(/\/.+$/,"")})),i($=>$+1)})))}let F=yield C;if(_.length>0&&F){let Z={commit:Ce(((B=(V=v==null?void 0:v.repository)==null?void 0:V.object)==null?void 0:B.__typename)==="Tree"?v.repository.object.commitUrl:""),generated:new Date().toUTCString(),metadata:_.filter(Boolean)},j=ge({message:"chore: Updates metadata DB",owner:d,name:u,branch:p,oid:F});j.replaceFile(`${x?x+"/":""}${h}/metadata.json`,Ae(Z));let M=j.createInput();try{yield b({variables:{input:M}})}catch($){console.error($)}}}))().catch(console.error)},[c,(R=v==null?void 0:v.repository)==null?void 0:R.object,w,p,d,u,f,m,h,x,b]),Pr(()=>{a===s&&t&&t()},[t,a,s]),e?Ii("div",y(g({},o),{children:[a,"\xA0/\xA0",s]})):Fi("div",g({},o))};import{clsx as Ri}from"clsx";import{useState as $i}from"react";import{jsx as re,jsxs as Ne}from"react/jsx-runtime";function fo(){let[e,t]=$i(!1),{repoSlug:o,repoBranch:r,contentPath:n}=L();return Ne(te,{title:"Settings",children:[re("div",{className:"mb-8 flex h-12 items-center",children:re("h1",{className:"mr-12 text-2xl",children:"Settings"})}),Ne("div",{className:"max-w-lg",children:[Ne("div",{className:"mb-8 max-w-2xl p-8 px-4 md:p-8 text-white bg-black rounded-lg border-2 border-neutral-800 shadow-md prose prose-base",children:[re("h2",{className:"text-white",children:"Metadata"}),Ne("div",{className:"flex flex-row items-center",children:[re("button",{className:Ri("cursor-pointer rounded-lg px-5 py-2.5 text-sm font-medium focus:outline-none focus:ring-4 focus:ring-neutral-800 no-underline","text-white","bg-neutral-800",e&&"bg-neutral-700"),onClick:()=>t(!0),children:e?"Rebuilding...":"Rebuild Metadata"}),re(Ar,{className:"pl-2",rebuild:e,onComplete:()=>t(!1)})]}),re("p",{className:"text-sm",children:"If you've made changes outside of outstatic, or if you are seeing posts with incorrect metadata, you can rebuild your metadata and automatically deploy those changes to your site."})]}),Ne("div",{className:"mb-8 max-w-2xl p-8 px-4 md:p-8 text-white bg-black rounded-lg border-2 border-neutral-800 shadow-md prose prose-base",children:[re("h2",{className:"text-white",children:"Environment"}),Ne("div",{children:[re("label",{className:"block mb-2 text-sm font-medium text-neutral-500",children:"Repository"}),re("input",{className:"cursor-not-allowed block p-2 w-full text-neutral-200 bg-neutral-950 rounded-lg border border-neutral-800 sm:text-sm outline-none",value:o,readOnly:!0})]}),Ne("div",{className:"mt-4",children:[re("label",{className:"block mb-2 text-sm font-medium text-neutral-500",children:"Branch"}),re("input",{className:"cursor-not-allowed block p-2 w-full text-neutral-200 bg-neutral-950 rounded-lg border border-neutral-800 sm:text-sm outline-none",value:r,readOnly:!0})]}),Ne("div",{className:"mt-4",children:[re("label",{className:"block mb-2 text-sm font-medium text-neutral-500",children:"Content Path"}),re("input",{className:"cursor-not-allowed block p-2 w-full text-neutral-200 bg-neutral-950 rounded-lg border border-neutral-800 sm:text-sm outline-none",value:`${n}`,readOnly:!0})]}),Ne("p",{className:"text-sm",children:["These values come from your Redevs environment. To learn more about how to update these values,"," ",re("a",{href:"https://outstatic.com/docs/environment-variables",target:"_blank",rel:"noreferrer",className:"underline font-semibold text-neutral-300",children:"click here"}),"."]})]})]})]})}import zi from"next/image";import{Fragment as Bi,jsx as se,jsxs as pt}from"react/jsx-runtime";function go({variables:e}){return se(Bi,{children:se("div",{className:"bg-black",id:"outstatic",children:pt("main",{className:"relative flex h-screen bg-black flex-col items-center justify-center z-10 p-4",children:[se("h1",{className:"mb-8 text-center text-xl font-semibold text-white border-2 px-6 p-2 rounded-full border-neutral-800",children:se(zi,{src:"https://redevs.org/redevs.svg",alt:"",width:150,height:100,className:"invert"})}),pt("div",{className:"mb-20 max-w-2xl p-8 px-4 md:p-8 text-white bg-black rounded-lg border-2 border-neutral-800 shadow-md",children:[se("p",{className:"mb-5",children:"Before you can access the Redevs Panel, make sure the following environment variables are set up:"}),se("ul",{className:"mb-5",children:Object.entries(e.required).map(([t,o])=>pt("li",{className:"mb-1",children:[`${o?"\u2705":"\u274C"} Variable`," ",se("span",{className:"font-semibold",children:t})," ",`is ${o?"set.":"missing!"}`]},t))}),!e.optional.OST_CONTENT_PATH&&pt("p",{className:"mb-5 p-2 bg-neutral-800 rounded",children:["Optional variable"," ",se("span",{className:"font-semibold",children:"OST_CONTENT_PATH"})," defines where your content is saved.",se("br",{}),"Defaulting to ",se("code",{children:"outstatic/content"})]}),!e.optional.OST_REPO_OWNER&&pt("p",{className:"mb-5 p-2 bg-neutral-800 rounded",children:["Optional variable"," ",se("span",{className:"font-semibold",children:"OST_REPO_OWNER"})," is not set.",se("br",{}),"Defaulting to your GitHub username."]}),se("p",{children:"You may need to restart Next.js to apply the changes."})]})]})})})}import{jsx as we,jsxs as Ui}from"react/jsx-runtime";var Vi={settings:we(fo,{}),collections:void 0},A0=({ostData:e,params:t})=>{var h,x;let[o,r]=ho((e==null?void 0:e.pages)||[]),[n,s]=ho((e==null?void 0:e.collections)||[]),l=ht(e==null?void 0:e.initialApolloState),[a,i]=ho(!1);if(_i(()=>{let f=v=>{a&&(v.preventDefault(),v.returnValue="")};return window.addEventListener("beforeunload",f),()=>{window.removeEventListener("beforeunload",f)}},[a]),e.missingEnvVars)return we(go,{variables:e.missingEnvVars});let c=f=>{o.includes(f)||n.includes(f)||(r([...o,f]),s([...n,f]))},m=f=>{r(o.filter(v=>v!==f)),s(n.filter(v=>v!==f)),console.log("removePage",f)},{session:b}=e;if(!b)return we(mo,{});let d=((h=t==null?void 0:t.ost)==null?void 0:h[0])||"",u=((x=t==null?void 0:t.ost)==null?void 0:x[1])||"";if(d&&!o.includes(d))return we(It,{});let p=d&&n.includes(d);return we(ko,y(g({},e),{pages:o,collections:n,addPage:c,removePage:m,hasChanges:a,setHasChanges:i,children:Ui(Hi,{client:l,children:[!d&&we(Qt,{}),u&&p&&we(ro,{collection:d}),!u&&p?we(so,{collection:d}):Vi[d],d==="collections"&&n.includes(u)&&we(Jt,{collection:u})||!!u&&!p&&we(po,{})]})}))};export{A0 as OstClient};
