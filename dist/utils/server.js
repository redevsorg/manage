"use strict";var I=Object.create;var x=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var $=Object.getPrototypeOf,J=Object.prototype.hasOwnProperty;var Q=(t,e)=>{for(var r in e)x(t,r,{get:e[r],enumerable:!0})},E=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of R(e))!J.call(t,n)&&n!==r&&x(t,n,{get:()=>e[n],enumerable:!(s=v(e,n))||s.enumerable});return t};var _=(t,e,r)=>(r=t!=null?I($(t)):{},E(e||!t||!t.__esModule?x(r,"default",{value:t,enumerable:!0}):r,t)),X=t=>E(x({},"__esModule",{value:!0}),t);var S=(t,e,r)=>new Promise((s,n)=>{var f=u=>{try{l(r.next(u))}catch(m){n(m)}},d=u=>{try{l(r.throw(u))}catch(m){n(m)}},l=u=>u.done?s(u.value):Promise.resolve(u.value).then(f,d);l((r=r.apply(t,e)).next())});var V={};Q(V,{getCollections:()=>z,getDocumentBySlug:()=>C,getDocumentPaths:()=>q,getDocumentSlugs:()=>B,getDocuments:()=>U,load:()=>k});module.exports=X(V);var y=_(require("fs")),j=_(require("gray-matter")),h=require("path");var w=require("fs/promises"),O=require("path"),M=_(require("gray-matter")),N=_(require("sift")),P=require("thenby");var G=(0,O.join)(process.cwd(),process.env.OST_CONTENT_PATH||"outstatic/content"),K=(0,O.resolve)(G,"./metadata.json"),k=()=>S(void 0,null,function*(){var s;let t=yield(0,w.readFile)(K),e=JSON.parse(t.toString()),r=(s=e==null?void 0:e.metadata)!=null?s:[];return{find:(n,f)=>{let d=r.filter((0,N.default)(n)),l=f!=null?f:[],u=0,m,i={sort:o=>{let g=(c,p)=>{let T=p;for(let[F,H]of Object.entries(c))T=T.thenBy(F,{direction:H>=0?"asc":"desc"});return T},D=(c,p)=>p.thenBy(c);if(typeof o=="number"||typeof o=="symbol")throw new Error("sort must be either an array of fields or an object containing field keys and sort directions");if(typeof o=="string")return d.sort((0,P.firstBy)(o,{direction:"asc"})),i;if(!Array.isArray(o)){let c=(0,P.firstBy)("\0");return c=g(o,c),d.sort(c),i}let a;for(let c of o){if(!a)if(typeof c=="string"){a=(0,P.firstBy)(c,{direction:"asc"});continue}else a=(0,P.firstBy)("\0");if(!a)throw new Error("Unreachable condition: !fn");if(typeof c=="string")a=D(c,a);else{if(typeof c=="number"||typeof c=="symbol")throw new Error("sort must be either an array of fields or an object containing field keys and sort directions");a=g(c,a)}}return a&&d.sort(a),i},project:o=>(l=o,i),skip:o=>(u=o,i),limit:o=>(m=o,i),first:()=>S(void 0,null,function*(){let o=yield i.toArray();return o==null?void 0:o[0]}),toArray:()=>S(void 0,null,function*(){let o=JSON.parse(JSON.stringify(d)).slice(u,m?u+m:void 0),g=Array.isArray(l)?l:Object.keys(l);return yield Promise.all(o.map(a=>S(void 0,null,function*(){if(g.length===0||g.includes("content")){let p=process.env.OST_MONOREPO_PATH?a.__outstatic.path.replace(process.env.OST_MONOREPO_PATH,""):a.__outstatic.path,T=yield(0,w.readFile)((0,O.resolve)(process.cwd(),`./${p}`)),{content:F}=(0,M.default)(T.toString());a.content=F}let c={};for(let p of g)typeof a[p]!="undefined"&&(c[p]=a[p]);return c})))})};return i}}});var b=(0,h.join)(process.cwd(),process.env.OST_CONTENT_PATH||"outstatic/content"),A=/\.mdx?$/i;function B(t){let e=(0,h.join)(b,t);return L(e).map(n=>n.replace(A,""))}function C(t,e,r=[]){try{let s=e.replace(A,""),n=(0,h.join)(b,t),f=(0,h.join)(n,`${s}.md`);if(!y.default.existsSync(f))return console.error("File does not exist:",f),null;let d=y.default.readFileSync(f,"utf8"),{data:l,content:u}=(0,j.default)(d),m={};return l.status==="draft"?null:(r.forEach(i=>{i==="slug"&&(m[i]=s),i==="content"&&(m[i]=u),typeof l[i]!="undefined"&&(m[i]=l[i])}),m)}catch(s){return console.error({getDocumentBySlug:s}),null}}function U(t,e=[]){return B(t).map(n=>C(t,n,[...e,"publishedAt","status"])).filter(n=>n!==null&&n.status==="published").sort((n,f)=>n.publishedAt>f.publishedAt?-1:1)}var q=t=>{try{return y.default.readdirSync(b+"/"+t).filter(n=>A.test(n)).filter(n=>{let f=(0,h.join)(b,t),d=(0,h.join)(f,`${n}`),l=y.default.readFileSync(d,"utf8"),{data:u}=(0,j.default)(l);return u.status==="published"}).map(n=>n.replace(A,"")).map(n=>({params:{slug:n}}))}catch(e){return console.error({getDocumentPaths:e}),[]}},z=()=>{try{return y.default.readdirSync(b).filter(e=>!/\.json$/.test(e))}catch(t){return console.error({getCollections:t}),[]}};function L(t){try{return y.default.readdirSync(t,{withFileTypes:!0}).filter(s=>s.isFile()&&A.test(s.name)).map(s=>s.name)}catch(e){return console.error({readMdMdxFiles:e}),[]}}0&&(module.exports={getCollections,getDocumentBySlug,getDocumentPaths,getDocumentSlugs,getDocuments,load});
